<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="nutrition_workout_history">TrackYou Historia</title>
    <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='images/favicon-16x16.png') }}">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='images/favicon-32x32.png') }}">
    <link rel="icon" type="image/png" sizes="48x48" href="{{ url_for('static', filename='images/favicon-48x48.png') }}">
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Calibri&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <script src="/static/js/translationshistory.js"></script>

    <style>
        /* === MAIN STYLES === */
        body {
            font-family: 'Roboto', sans-serif;
            font-size: 12px;
            background-color: #161616 !important;
            color: #e0e0e0;
            padding-bottom: 20px;
        }
        
        .bg-black, .modal-header, .modal-footer {
            background-color: #0c0c0c !important;
            border-color: #444;
        }
        .bg-warning {
            border: 1px solid !important;
            border-color: #060606 !important;
            font-size: 10px !important;
            box-shadow:#222 !important;
            font-weight: bold !important;
        }
        
        /* === NEW BUTTON STYLES === */
        .btn-jere {
            display: inline-block;
            background-color: #1b1b1b;
            color: #ffffff;
            border: 1px solid #444;
            border-radius: 20px;
            padding: 8px 12px;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.1s ease;
            cursor: pointer;
        }

        .btn-jere:hover {
            background-color: #ffffff !important;
            color: black !important;
            transform: scale(1.02);
        }

        .btn-jere.active {
            background: #ffffff !important;
            color: #000000 !important;
            transform: scale(1.01) !important ;
        }
        .btn-jere.focus {
             background: #ffffff !important;
            color: #000000 !important;
            transform: scale(1.03);
        }
                .btn-jerew {
            display: inline-block !important;
            background-color: #1b1b1b !important;
            color: #ffffff !important;
            border: 1px solid #444 !important;
            border-radius: 5px !important;
            padding: 14px 16px !important;
            font-size: 14px !important;
            font-weight: 600;
            transition: all 0.1s ease;
            cursor: pointer;
        }

        .btn-jerew:hover {
            background-color: #ffffff !important;
            color: black !important;
            transform: scale(1.02);
        }

        .btn-jerew.active {
            background: #ffffff !important;
            color: #000000 !important;
            transform: scale(1.01) !important ;
        }
        .btn-jerew.focus {
             background: #ffffff !important;
            color: #000000 !important;
            transform: scale(1.03);
        }
        
        /* Make tabs use the new button style */
        .nav-tabs .nav-link {
            display: inline-block;
            background-color: #1b1b1b;
            color: #ffffff;
            border: 1px solid #444;
            border-radius: 20px;
            padding: 8px 12px;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.1s ease;
            margin-right: 5px;
            margin-bottom: 10px;
        }


        /* ===== NAV LINK BOX ===== */
        .nav-link-box {
            display: inline-block;
            background-color: #1b1b1b;
            color: #ffffff;
            border: 1px solid #444 !important;
            border-radius: 20px;
            padding: 0;
            margin: 0 3px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 35px;
            height: 35px;
        }

        .nav-link-box:hover {
            background-color: #f0f0f0 !important;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            color: black !important;
        }

        .nav-link-box i {
            font-size: 14px !important;
            margin: 0 !important;
        }
        
        .nav-logo-box {
            display:inline-block;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            border-radius: 50px;
            padding: 2px;
            margin: 0 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 55px;
            height: 55px;
            z-index: 1050 !important;
        }
        
        .nav-logo-box img.nav-logo {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .btn-beta {
            display: inline-block;
            background-color: #8b34f6;
            color: #ffffff;
            border: 1px solid #000000 !important;
            border-radius: 30px;
            text-align: center;
            padding: 2px 20px;
            font-size: 12px;
            font-weight: bold;
            box-shadow: 0px 1px 5px rgb(179, 179, 180);
            cursor:auto !important;
        }
        
        /* ===== MOBILE NAVIGATION ===== */
        .mobile-settings-btn {
            display: inline-block;
            background-color: #1b1b1b;
            color: rgb(255, 255, 255) !important;
            border-radius: 50%;
            padding: 10px !important;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            margin-left: 10px
        }
        
        .mobile-settings-btn:hover {
            background-color: #f0f0f0 !important;
            transform: translateY(-4px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            color: #000 !important;
        }

        .mobile-settings-btn i {
            font-size: 20px !important;
            margin: 0 !important;
        }

        /* === HISTORY PAGE REDESIGN === */
        .history-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 15px;
        }

        /* Header with gradient */
        .page-header {
            background: linear-gradient(135deg, #1a1a1a 0%, #0c0c0c 100%);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid #444;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .page-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
            background: linear-gradient(to right, #ffffff, #b1b0b0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .page-subtitle {
            color: #b1b0b0;
            font-size: 14px;
        }

        /* Card styles */
        .history-card {
            background: linear-gradient(135deg, #1a1a1a 0%, #0c0c0c 100%);
            border-radius: 15px;
            border: 1px solid #444;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            margin-bottom: 20px;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .history-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.4);
        }

        .card-header-custom {
            background: linear-gradient(to right, #333, #222);
            border-bottom: 1px solid #444;
            padding: 15px 20px;
            font-weight: 600;
            font-size: 18px;
            color: #e0e0e0;
        }

        /* Tab styles - UPDATED with new button style */
        .nav-tabs {
            border-bottom: none;
            padding: 0 15px;
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        /* Tooltip container */
        .tooltip {
            opacity: 1 !important; /* prevent Bootstrap fade weirdness */
        }

        /* Tooltip bubble */
        .tooltip .tooltip-inner {
            background-color: #1b1b1b; /* match nav-link-box background */
            color: #fff;
            font-size: 0.75rem;
            font-weight: 500;
            padding: 6px 10px;
            border-radius: 10px; /* softer pill look */
            border: 1px solid #444;
            box-shadow: 0 2px 6px rgba(0,0,0,0.4);
        }
        /* Weekly nutrition fonts */
        #weekly-nutrition table thead th {
    font-weight: bold;
}
#weekly-nutrition th[data-i18n="avg_calories_g"] {color: rgb(255, 255, 255); font-weight: bold;}
#weekly-nutrition tbody td:nth-child(2) {color: rgb(255, 255, 255); font-weight: bold;}
#weekly-nutrition th[data-i18n="avg_protein_g"] {color: rgb(184, 118, 231); font-weight: bold;}
#weekly-nutrition tbody td:nth-child(3) {color: rgb(184, 118, 231); font-weight: bold;}
#weekly-nutrition th[data-i18n="avg_carbs_g"] {color: rgb(0, 179, 255); font-weight: bold;}
#weekly-nutrition tbody td:nth-child(4) {color: rgb(0, 179, 255); font-weight: bold;}
#weekly-nutrition th[data-i18n="avg_fats_g"] {color: rgb(255, 194, 13); font-weight: bold;}
#weekly-nutrition tbody td:nth-child(5) {color: rgb(255, 194, 13); font-weight: bold;}
#weekly-nutrition th[data-i18n="avg_salt_g"] {color: rgb(0, 119, 255); font-weight: bold;}
#weekly-nutrition tbody td:nth-child(8) {color: rgb(0, 119, 255); font-weight: bold;}
#weekly-nutrition th[data-i18n="avg_saturated_g"] {color: rgb(171, 138, 19); font-weight: bold;}
#weekly-nutrition tbody td:nth-child(6) {color: rgb(171, 138, 19); font-weight: bold;}
#weekly-nutrition th[data-i18n="avg_sugars_g"] {color: rgb(20, 212, 230); font-weight: bold;}
#weekly-nutrition tbody td:nth-child(7) {color: rgb(20, 212, 230); font-weight: bold;}
#weekly-nutrition th[data-i18n="avg_fiber_g"] {color: rgb(255, 188, 17); font-weight: bold;}
#weekly-nutrition tbody td:nth-child(9) {color: rgb(255, 188, 17); font-weight: bold;}
        /* NEW WORKOUT CARD STYLES */
        .workout-period-card {
            background: linear-gradient(135deg, #1a1a1a 0%, #0c0c0c 100%); /* Match summary cards */
            border: 1px solid #444;
            border-radius: 12px;
            margin-bottom: 10px; /* Reduced from 12px */
            cursor: pointer;
            transition: all 0.2s ease;
            padding: 12px 15px; /* Reduced from 15px 20px */
            box-shadow: 0 5px 15px rgba(0,0,0,0.3); /* Add shadow like summary cards */
        }

                    .workout-period-card:hover {
                background: linear-gradient(135deg, #333 0%, #222 100%); /* Match summary card hover */
                transform: translateY(-3px); /* Match summary card hover transform */
                box-shadow: 0 10px 25px rgba(0,0,0,0.4);
            }

        .workout-period-card .period-title {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 8px;
            color: #ffd166;
        }

        .workout-period-card .period-stats {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .workout-period-card .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 60px;
        }

        .workout-period-card .stat-value {
            font-size: 18px;
            font-weight: 600;
            color: #ffffff;
        }

        .workout-period-card .stat-label {
            font-size: 10px;
            color: #888;
            text-transform: uppercase;
            margin-top: 2px;
        }

        /* Workout Detail View */
        .workout-detail-view {
            display: none;
        }

       .workout-detail-header {
    background: linear-gradient(135deg, #1a1a1a 0%, #0c0c0c 100%);
    border-radius: 12px;
    padding: 15px; /* Reduced from 20px */
    margin-bottom: 15px; /* Reduced from 20px */
    border: 1px solid #444;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3); /* Add shadow like summary cards */
    display: flex;
    justify-content: space-between;
    align-items: center;
}

        .workout-detail-title {
            font-size: 24px;
            font-weight: 700;
            color: #ffd166;
            margin-bottom: 5px;
        }

        .workout-detail-subtitle {
            font-size: 14px;
            color: #b1b0b0;
        }

        .workout-summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .workout-summary-card {
            background: linear-gradient(135deg, #1a1a1a 0%, #0c0c0c 100%);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #444;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .workout-summary-card:hover {
            transform: translateY(-3px);
        }

        .workout-summary-card .card-icon {
            font-size: 24px;
            margin-bottom: 10px;
            display: block;
        }

        .workout-summary-card .card-title {
            font-size: 14px;
            color: #b1b0b0;
            margin-bottom: 8px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .workout-summary-card .card-value {
            font-size: 24px;
            font-weight: 700;
            color: #ffffff;
        }

        .workout-summary-card.sessions .card-icon { color: #4cc9f0; }
        .workout-summary-card.muscle-groups .card-icon { color: #f72585; }
        .workout-summary-card.sets .card-icon { color: #06d6a0; }
        .workout-summary-card.reps .card-icon { color: #ffd166; }
        .workout-summary-card.volume .card-icon { color: #ff6b35; }

        /* Muscle Group Details */
       .muscle-group-details {
    background: linear-gradient(135deg, #1a1a1a 0%, #0c0c0c 100%);
    border-radius: 12px;
    padding: 15px; /* Reduced from 20px */
    border: 1px solid #444;
    margin-bottom: 15px; /* Reduced from 20px */
    box-shadow: 0 5px 15px rgba(0,0,0,0.3); /* Add shadow like summary cards */
}

        .muscle-group-details h5 {
            color: #ffd166;
            margin-bottom: 15px;
            font-weight: 600;
        }
        .muscle-detail-card:first-child {
        border-top: 1px solid #444;
        border-radius: 12px 12px 0 0; /* Round top corners of first card */
    }
    .muscle-detail-card:last-child {
        border-radius: 0 0 12px 12px;
    }
    .exercise-detail-section {
    margin: 0 -15px; /* Negative margin to counteract parent padding */
    padding: 0;
    background: linear-gradient(135deg, #1a1a1a 0%, #0c0c0c 100%);
    border-radius: 0;
    overflow: visible;
}

            .muscle-detail-card {
            background: linear-gradient(135deg, #1a1a1a 0%, #0c0c0c 100%); /* Match summary cards instead of solid #0c0c0c */
            border: 1px solid #444; /* Consistent with summary cards */
            border-radius: 0px;
            padding: 12px 15px; /* Reduced from 15px */
            margin-bottom: 0px; /* Reduced from 10px */
            border-left: 4px solid #ffd166;
            box-shadow: none;
            border-top: none;
        }

        .muscle-detail-card .muscle-name {
            font-weight: 600;
            color: #ffd166;
            margin-bottom: 8px;
        }

        .muscle-detail-card .muscle-stats {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .muscle-detail-card .muscle-stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 50px;
        }

        .muscle-detail-card .muscle-stat-value {
            font-size: 16px;
            font-weight: 600;
            color: #ffffff;
        }

        .muscle-detail-card .muscle-stat-label {
            font-size: 10px;
            color: #888;
            text-transform: uppercase;
        }

        .period-row {
            background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%) !important;
            border: 1px solid #444;
            border-radius: 8px;
            margin-bottom: 8px !important;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .period-row:hover {
            background: linear-gradient(135deg, #333 0%, #222 100%) !important;
            transform: translateY(-1px);
        }

        .period-row.collapsed .collapse-icon {
            transform: rotate(-90deg);
        }

        .muscle-row {
            background-color: #1a1a1a !important;
            border-left: 3px solid #ffd166;
            margin-left: 20px;
        }

        /* Compact metrics display */
        .compact-metrics {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 10px;
            padding: 8px 0;
        }

        .metric-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 60px;
        }

        .metric-value {
            font-size: 16px;
            font-weight: 600;
            color: #ffd166;
        }

        .metric-label {
            font-size: 10px;
            color: #888;
            text-transform: uppercase;
        }

        /* Tooltip arrow */
        .tooltip.bs-tooltip-top .tooltip-arrow::before {
            border-top-color: #1b1b1b;
        }
        
        .tooltip.bs-tooltip-bottom .tooltip-arrow::before {
            border-bottom-color: #1b1b1b;
        }
        
        .tooltip.bs-tooltip-start .tooltip-arrow::before {
            border-left-color: #1b1b1b;
        }
        
        .tooltip.bs-tooltip-end .tooltip-arrow::before {
            border-right-color: #1b1b1b;
        }
        
        /* ===== DROPDOWNS & MODALS ===== */
        .dropdown-menu {
            background-color: #1e1e1e;
            border: 1px solid #333;
            right: 0 !important;
            width: 120px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            position: absolute;
        }

        .dropdown-item {
            color: #fff;
        }

        .dropdown-item:hover {
            background-color: #333;
            color: #ffffff;
        }

        /* Table styles - UPDATED WITH BLACK BACKGROUND AND WHITE TEXT */
        .table-container {
            border-radius: 10px;
            overflow: hidden;
            margin: 0; /* Remove margin-bottom: 20px */
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            background: linear-gradient(135deg, #1a1a1a 0%, #0c0c0c 100%); /* Use summary card gradient */
            border: 1px solid #444; /* Add border like summary cards */
            box-shadow: 0 5px 15px rgba(0,0,0,0.3); /* Add shadow like summary cards */
            }

         .table-custom {
            color: #ffffff;
            margin-bottom: 0;
            border-collapse: separate;
            border-spacing: 0;
            background-color: transparent; /* Let container gradient show through */
            min-width: 600px;
        }

                .table-custom th {
            background: linear-gradient(135deg, #333 0%, #1b1b1b 50%, #333 100%); /* Match summary card styling */
            border-bottom: 2px solid #444;
            padding: 8px 10px; /* Reduced from 12px 15px */
            font-weight: 600;
            text-align: left;
            position: sticky;
            top: 0;
            z-index: 10;
            color: #ffffff;
            white-space: nowrap;
        }

        
        .table-custom td {
    padding: 8px 10px; /* Reduced from 12px 15px */
    vertical-align: middle;
    border-bottom: 1px solid #333;
    background-color: transparent; /* Let container gradient show through */
    color: #ffffff;
    white-space: nowrap;
}

        .table-custom tbody tr {
            transition: background-color 0.2s ease;
        }

        .table-custom tbody tr:hover {
            background-color: #1a1a1a; /* Darker hover effect */
        }

        .table-custom tbody tr:hover td {
            background-color: #1a1a1a; /* Ensure hover effect applies to cells */
        }

        .table-custom tbody tr:last-child td {
            border-bottom: none;
        }

        /* Tab content - UPDATED WITH BLACK BACKGROUND */
        .tab-content {
            background: linear-gradient(135deg, #1a1a1a 0%, #0c0c0c 100%); /* Use summary card gradient */
            color: #ffffff;
            padding: 10px; /* Reduced from 15px */
            border-radius: 0 0 10px 10px;
            overflow-x: auto;
            border: 1px solid #444; /* Add border like summary cards */
            box-shadow: 0 5px 15px rgba(0,0,0,0.3); /* Add shadow like summary cards */
        }

        /* Summary cards */
        .summary-card {
            background: linear-gradient(135deg, #1a1a1a 0%, #0c0c0c 100%);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #444;
            text-align: center;
            transition: transform 0.3s ease;
            height: 100%;
        }

        .summary-card:hover {
            transform: translateY(-5px);
        }

        .summary-value {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .summary-label {
            font-size: 14px;
            color: #b1b0b0;
        }

        /* Button styles - REPLACED with btn-jere */
        .btn-custom {
            display: inline-block;
            background-color: #1b1b1b;
            color: #ffffff;
            border: 1px solid #444;
            border-radius: 20px;
            padding: 8px 12px;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.1s ease;
        }

        .btn-custom:hover {
            background-color: #d4d4d4 !important;
            color: black !important;
            transform: scale(1.02);
        }

        .btn-custom.active {
            background: #858585 !important;
            color: #000000 !important;
        }

        /* Stats highlights */
        .stat-highlight {
            padding: 15px;
            border-radius: 10px;
            background: linear-gradient(135deg, #1a1a1a 0%, #0c0c0c 100%);
            border: 1px solid #444;
            margin-bottom: 15px;
        }

        .stat-value {
            font-size: 20px;
            font-weight: 700;
        }

        .stat-label {
            font-size: 14px;
            color: #b1b0b0;
        }
        
        .text-muted {
            color: white !important;
        }
        
        /* Progress bars */
        .progress {
            height: 8px;
            background-color: #2a2a2a;
            border-radius: 4px;
            margin-top: 5px;
        }

        .progress-bar-protein {
            background: linear-gradient(to right, #b989f0, #835fac); }
        .progress-bar-carbs 
            { background: linear-gradient(to right, #6dc0d5, #929292); color:#000000; }
        .progress-bar-fats { background: linear-gradient(to right, #ff9e6d, #8f5639); color:#000000; }
        .progress-bar-salt { background: linear-gradient(to right, #6dc0d5, #3f7481); color:#000000; }
        .progress-bar-saturated { background: linear-gradient(to right, #ffd166, #b39347); color:#000000; }
        .progress-bar-fiber { background: linear-gradient(to right, #ffbe9e, #b3846e); color:#000000; }
        .progress-bar-sugars { background: linear-gradient(to right, #7bc8a4, #4e8e71); color:#000000; }

        .exercise-search-container {
            position: relative;
            margin-bottom: 15px;
        }

        .exercise-filters {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            overflow-x: auto;
            padding-bottom: 5px;
            -webkit-overflow-scrolling: touch;
        }

        .muscle-group-filter {
            flex-shrink: 0;
            padding: 4px 8px;
            font-size: 10px;
            border-radius: 12px;
            background: #1b1b1b;
            color: #fff;
            border: 1px solid #444;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .muscle-group-filter.active {
            background: #ffd166;
            color: #000;
        }

        /* Enhanced exercise list items */
        .exercise-row {
            transition: background-color 0.2s ease;
            cursor: pointer;
        }

        .exercise-row:hover {
            background-color: #1a1a1a !important;
        }

        .exercise-row:hover td {
            background-color: #1a1a1a !important;
        }

        /* Empty state styling */
        .empty-state {
            padding: 40px 20px;
            text-align: center;
            color: #888;
        }

        .empty-state i {
            font-size: 50px;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .expandable-trigger {
            min-height: 44px;
            display: flex;
            align-items: center;
            padding: 8px 12px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: border-color 0.2s ease;
            border-radius: 8px;
        }

        .expandable-trigger:active {
            border-color: #ffd166;
            background-color: rgba(255, 209, 102, 0.1);
        }

        /* Enhanced empty states */
        .empty-state {
            padding: 30px 15px !important;
            text-align: center;
        }

        .empty-state i {
            font-size: 40px !important;
            margin-bottom: 12px !important;
            opacity: 0.6;
            color: #888;
        }

        .empty-state h4 {
            font-size: 16px;
            margin-bottom: 8px;
            color: #fff;
        }

        .empty-state p {
            font-size: 12px;
            color: #888;
            margin-bottom: 15px;
            line-height: 1.4;
        }

        /* Loading states */
        .loading-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px 20px;
        }

        .loading-spinner {
            width: 30px;
            height: 30px;
            border: 3px solid #333;
            border-top: 3px solid #ffd166;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 12px;
            color: #888;
        }
        /* Enhanced Exercise Search and Filter Container */
.exercise-search-filter-container {
    display: flex;
    flex-direction: column;
    gap: 15px;
    background: linear-gradient(135deg, #1a1a1a 0%, #0c0c0c 100%);
    border: 1px solid #444;
    border-radius: 15px;
    padding: 20px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
}

/* Webkit-styled Search Input */
.exercise-search-wrapper {
    position: relative;
    flex: 1;
}

.exercise-search-input {
    width: 100%;
    background-color: #1b1b1b;
    color: #ffffff;
    border: 1px solid #444;
    border-radius: 20px;
    padding: 12px 45px 12px 20px;
    font-size: 14px;
    font-weight: 500;
    transition: all 0.2s ease;
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
    -webkit-appearance: none;
    appearance: none;
}

.exercise-search-input:focus {
    outline: none;
    border-color: #ffd166;
    box-shadow: 0 0 0 2px rgba(255, 209, 102, 0.2), inset 0 2px 4px rgba(0,0,0,0.2);
    background-color: #222;
}

.exercise-search-input::placeholder {
    color: #888;
}

.exercise-search-icon {
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: #888;
    pointer-events: none;
}

        /* Enhanced Muscle Group Filters matching btn-jere style */
        .exercise-filters {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            align-items: center;
        }

        .muscle-group-filter {
            display: inline-block;
            background-color: #1b1b1b;
            color: #ffffff;
            border: 1px solid #444;
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.1s ease;
            cursor: pointer;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .muscle-group-filter:hover {
            background-color: #ffffff !important;
            color: black !important;
            transform: scale(1.02);
        }

        .muscle-group-filter.active {
            background: #ffffff !important;
            color: #000000 !important;
            transform: scale(1.01) !important;
        }

        /* Sortable Table Headers */
        .sortable-header {
            cursor: pointer;
            user-select: none;
            transition: all 0.2s ease;
            position: relative;
        }

        .sortable-header:hover {
            background-color: #444 !important;
            color: #ffd166 !important;
        }

        .sortable-header.active {
            background-color: #333 !important;
            color: #ffd166 !important;
        }

        .sort-icon {
            opacity: 0.5;
            margin-left: 5px;
            font-size: 10px;
            transition: opacity 0.2s ease;
        }

        .sortable-header:hover .sort-icon,
        .sortable-header.active .sort-icon {
            opacity: 1;
        }

        .sortable-header.asc .sort-icon:before {
            content: "\f0de"; /* fa-sort-up */
        }

        .sortable-header.desc .sort-icon:before {
            content: "\f0dd"; /* fa-sort-down */
        }
        .workout-summary-card.duration .card-icon { 
    color: #17a2b8; /* Info blue color */
}

.workout-summary-card.calories .card-icon { 
    color: #fd7e14; /* Orange color for fire/calories */
}

        /* Cardio breakdown section */
        .cardio-breakdown-section {
            margin-top: 20px;
        }

        .cardio-session-card {
            background: linear-gradient(135deg, #1a1a1a 0%, #0c0c0c 100%);
            border: 1px solid #444;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #06d6a0;
            transition: transform 0.2s ease;
        }

        .cardio-session-card:hover {
            transform: translateX(5px);
        }

        .cardio-session-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .cardio-type {
            font-weight: 600;
            color: #06d6a0;
            font-size: 14px;
        }

        .cardio-stats {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .cardio-stat-item {
            display: flex;
            flex-direction: column;
            min-width: 60px;
        }

        .cardio-stat-label {
            font-size: 10px;
            color: #888;
            text-transform: uppercase;
        }

        .cardio-stat-value {
            font-size: 14px;
            font-weight: 600;
            color: #ffffff;
        }

        /* Collapsible muscle group */
        .muscle-detail-card {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .muscle-detail-card.expanded {
            border-left: 4px solid #06d6a0;
        }

        .muscle-collapse-icon {
            transition: transform 0.3s ease;
            float: right;
            color: #888;
        }

        .muscle-detail-card.expanded .muscle-collapse-icon {
            transform: rotate(180deg);
        }

        /* Loading spinner for muscle details */
        .muscle-loading {
            text-align: center;
            padding: 20px;
            color: #888;
        }
        /* Custom PR tooltips */
    .pr-tooltip {
        position: relative;
        display: inline-block;
        z-index: 1; /* Base z-index */
    }

    .pr-tooltip .tooltip-text {
        visibility: hidden;
        position: absolute;
        background-color: #333;
        color: #fff;
        text-align: center;
        padding: 6px 10px;
        border-radius: 6px;
        font-size: 11px;
        white-space: nowrap;
        
        /* Position the tooltip */
        position: absolute;
        z-index: 9999;
        bottom: 150%;
        left: 50%;
        transform: translateX(-50%);
        
        /* Fade in */
        opacity: 0;
        transition: opacity 0.3s;
        pointer-events: none;
    }

    .pr-tooltip .tooltip-text::after {
        content: "";
        position: absolute;
        top: 100%;
        left: 50%;
        margin-left: -6px;
        border-width: 6px;
        border-style: solid;
        border-color: #333 transparent transparent transparent;
    }

    /* Show tooltip on hover (desktop) */
    .pr-tooltip:hover .tooltip-text {
        visibility: visible;
        opacity: 1;
        z-index: 10000;
    }

    /* Mobile: Show on touch/click */
    .pr-tooltip.active .tooltip-text {
        visibility: visible;
        opacity: 1;
    }
    .pr-tooltip.tooltip-below .tooltip-text {
    bottom: auto;
    top: 150%;
}
.pr-tooltip.tooltip-below .tooltip-text::after {
    top: auto;
    bottom: 100%;
    border-color: transparent transparent #ffd166 transparent;
}
        /* PR Badge Styling */
            .pr-badge {
                display: inline-block;
                font-size: var(--font-size-lg);
                animation: prPulse var(--duration-normal) infinite;
                margin: 0 var(--space-2);
            }

            .pr-badge.pr-double {
                animation: prGlow calc(var(--duration-normal) * 0.6) infinite;
            }

            /* PR Row Highlighting */
            .pr-row {
                background: linear-gradient(90deg, var(--color-bg-2) 0%, rgba(var(--color-warning-rgb), 0.05) 100%) !important;
                border-left: var(--space-4) solid var(--color-warning) !important;
            }

            .pr-row td {
                font-weight: var(--font-weight-bold) !important;
                background-color: transparent !important;
            }

            .pr-row:hover td {
                background: linear-gradient(90deg, rgba(var(--color-warning-rgb), 0.2) 0%, rgba(var(--color-warning-rgb), 0.1) 100%) !important;
            }

            /* PR Badge Animations */
            @keyframes prPulse {
                0%, 100% {
                    transform: scale(1);
                    opacity: 1;
                }
                50% {
                    transform: scale(1.15);
                    opacity: 0.85;
                }
            }

            @keyframes prGlow {
                0%, 100% {
                    transform: scale(1);
                    filter: drop-shadow(0 0 var(--space-2) var(--color-warning));
                }
                50% {
                    transform: scale(1.2);
                    filter: drop-shadow(0 0 var(--space-8) var(--color-warning)) drop-shadow(0 0 var(--space-12) var(--color-warning));
                }
            }

            /* Clickable Exercise Names */
            .clickable-exercise {
                cursor: pointer;
                display: flex;
                align-items: center;
                gap: var(--space-8);
                transition: all var(--duration-fast) var(--ease-standard);
                padding: var(--space-4) var(--space-8);
                border-radius: var(--radius-base);
                width: fit-content;
            }

            .clickable-exercise:hover {
                color: var(--color-warning) !important;
                transform: translateX(var(--space-4));
                background-color: rgba(var(--color-warning-rgb), 0.1);
            }

            .clickable-exercise:hover .fa-external-link-alt {
                color: var(--color-warning) !important;
                animation: linkBounce 0.6s var(--ease-standard) infinite;
            }

            .clickable-exercise .fa-external-link-alt {
                font-size: var(--font-size-base);
                color: var(--color-text-secondary);
                transition: all var(--duration-fast) var(--ease-standard);
            }

            @keyframes linkBounce {
                0%, 100% {
                    transform: translateY(0);
                }
                50% {
                    transform: translateY(calc(var(--space-4) * -0.75));
                }
            }

            /* Exercise Detail Table PR Column */
            .exercise-sets-table th:last-child,
            .exercise-sets-table td:last-child {
                text-align: center;
                width: 60px;
            }

            /* Add glow effect to table when PRs are present */
            .exercise-sets-table:has(.pr-row) {
                border: var(--space-1) solid rgba(var(--color-warning-rgb), 0.3);
                box-shadow: 0 0 var(--space-16) rgba(var(--color-warning-rgb), 0.1);
            }

            /* Tooltip for PR badges */
            .pr-badge[title]:hover::after {
                content: attr(title);
                position: absolute;
                background: var(--color-surface);
                color: var(--color-warning);
                padding: var(--space-4) var(--space-8);
                border-radius: var(--radius-sm);
                font-size: var(--font-size-xs);
                white-space: nowrap;
                z-index: 1000;
                margin-left: var(--space-10);
                border: var(--space-1) solid var(--color-warning);
                box-shadow: var(--shadow-md);
}
/* Exercise detail containers - DARK THEME */
    .exercise-detail-container {
        margin-bottom: 0;
        border: none;
        border-top: 1px solid #333; /* Just a separator line */
        border-radius: 0;
        overflow: visible;
        background: transparent;
        box-shadow: none;
    }


/* Clickable exercise header - DARK THEME */
.clickable-exercise-header {
    padding: 12px 15px;
    cursor: pointer;
    background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
    border-bottom: 1px solid #444;
    transition: background-color 0.2s;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-radius: 0; /* ✅ ADDED to maintain rounded corners */
}

.clickable-exercise-header:hover {
    background: linear-gradient(135deg, #333 0%, #222 100%);
}

/* Exercise title row - TOGGLE ON RIGHT SIDE */
.exercise-detail-title-row {
    display: flex;
    align-items: center;
    flex: 1;
}

.exercise-detail-title {
    font-weight: 600;
    font-size: 14px;
    color: #ffd166;
    flex: 1;
    display: flex;
    align-items: center;
    gap: 8px;
}

/* Chevron icon animation - MOVED TO RIGHT */
.exercise-chevron {
    font-size: 14px;
    transition: transform 0.2s;
    color: #888;
    order: 10 !important; /* Push to end of flex container */
    margin-left: auto;
}

.exercise-chevron.fa-chevron-down {
    transform: rotate(90deg);
}

/* Go to exercise icon */
.go-to-exercise {
    transition: color 0.2s, transform 0.2s;
    font-size: 14px;
    color: #888;
    margin-left: 8px;
}

.go-to-exercise:hover {
    color: #ffd166 !important;
    transform: scale(1.1);
}

/* Exercise summary stats */
.exercise-summary-stats {
    display: flex;
    gap: 10px;
    font-size: 11px;
    color: #888;
    margin-left: 15px;
}

.exercise-summary-stat {
    padding: 3px 8px;
    background: #1b1b1b;
    border-radius: 4px;
    border: 1px solid #444;
    color: #e0e0e0;
}

/* Exercise sets container */
.exercise-sets-container {
    padding: 0;
    background: linear-gradient(135deg, #1a1a1a 0%, #0c0c0c 100%);
    border-radius: 0;
    overflow: visible;
}

/* Exercise sets table - DARK THEME */
.exercise-sets-table {
    width: 100%;
    margin: 0;
    text-align: center !important;
    border-collapse: collapse;
    background: transparent;
    position: relative; /* ✅ ADDED for z-index stacking */
}


.exercise-sets-table thead {
    background: linear-gradient(135deg, #333 0%, #1b1b1b 50%, #333 100%);
}

.exercise-sets-table th {
    padding: 10px 12px;
    text-align: center;
    font-size: 11px;
    font-weight: 600;
    color: #ffd166;
    border-bottom: 1px solid #444;
}

.exercise-sets-table td {
    padding: 10px 12px;
    font-size: 12px;
    border-bottom: 1px solid #333;
    background: transparent;
    color: #e0e0e0;
    position: relative; /* ✅ ADDED for tooltip positioning */
}

.exercise-sets-table tbody tr:last-child td {
    border-bottom: none;
}

.exercise-sets-table tbody tr:hover {
    background: #1a1a1a;
}

.exercise-sets-table tbody tr:hover td {
    background: #1a1a1a;
}

/* PR row highlighting - DARK THEME */
.pr-row {
    background: rgba(255, 209, 102, 0.1) !important;
}

.pr-row td {
    background: rgba(255, 209, 102, 0.1) !important;
}

.pr-row:hover {
    background: rgba(255, 209, 102, 0.2) !important;
}

.pr-row:hover td {
    background: rgba(255, 209, 102, 0.2) !important;
}

.pr-badge {
    font-size: 14px;
    margin-right: 4px;
}
        /* Mobile-specific styles for horizontal scrolling */
        @media (max-width: 768px) {
                .clickable-exercise {
          font-size: var(--font-size-base);
            }
            
            .pr-badge {
                font-size: var(--font-size-base);
            }
            
            .clickable-exercise:hover {
                transform: translateX(var(--space-2));
            }
                    
            .history-container {
                overflow-x: hidden; /* Prevent horizontal scroll on container */
                margin-left: -10px;
                margin-right: -10px;
                width: 100%;
                padding: 0 10px;
                border-radius: 0;
                width: calc(100% + 20px);

            }
            
            .table-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                width: 100%;
            }
            
            .table-custom {
                min-width: 700px; /* Ensure table is wide enough to scroll */
            }
            .tab-content {
        padding: 8px; /* Even more compact on mobile */
        margin-left: -10px;
        margin-right: -10px;
        width: calc(100% + 20px);
        border-radius: 0;
    }
       .nav-tabs {
        padding: 0 10px;
        margin-left: -10px;
        margin-right: -10px;
        width: calc(100% + 20px);
        padding-bottom: 8px;
    }
    .nav-tabs .nav-link {
        padding: 5px 8px; /* Even more compact on mobile */
        font-size: 10px;
    }
     .table-custom th,
    .table-custom td {
        padding: 6px 4px; /* Very compact on mobile */
        font-size: 10px;
    }
            .page-title {
                font-size: 22px;
            }
            
            .nav-tabs .nav-link {
                font-size: 12px;
                padding: 8px 12px;
            }
            
            .table-custom th, 
            .table-custom td {
                padding: 10px 8px;
                font-size: 12px;
            }
            
            .summary-value {
                font-size: 20px;
            }
            
            /* Make summary cards more compact on mobile */
            .summary-card {
                padding: 15px 10px;
            }
            
            /* Adjust tab layout for mobile */
            .nav-tabs {
                flex-wrap: nowrap;
                overflow-x: auto;
                padding-bottom: 5px;
            }
            
            .nav-tabs .nav-link {
                white-space: nowrap;
                flex-shrink: 0;
            }

            .table-custom th {
                position: sticky !important;
                top: 0 !important;
                z-index: 20 !important;
                background: #0f0f0f !important;
                padding: 8px 6px !important;
                font-size: 11px !important;
                white-space: nowrap;
                box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            }
            
            .table-custom td {
                padding: 8px 6px !important;
                font-size: 11px !important;
                white-space: nowrap;
            }
            
            .expand-collapse-controls {
                position: sticky;
                top: 0;
                z-index: 15;
                background: #161616;
                padding: 10px 0;
                margin-bottom: 10px;
                display: flex;
                gap: 10px;
                justify-content: center;
                border-bottom: 1px solid #333;
            }
            
            #expand-all,
            #collapse-all {
                padding: 6px 12px !important;
                font-size: 11px !important;
                min-width: 80px;
            }

            /* Mobile adaptations for workout cards */
            .workout-summary-cards {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .workout-summary-card {
                padding: 15px 10px;
            }

            .workout-summary-card .card-value {
                font-size: 20px;
            }

            .muscle-detail-card .muscle-stats {
                gap: 10px;
            }
                .exercise-search-filter-container {
        padding: 15px;
        gap: 12px;
    }
    
    .exercise-search-input {
        padding: 10px 40px 10px 15px;
        font-size: 13px;
    }
    
    .muscle-group-filter {
        padding: 6px 12px;
        font-size: 11px;
    }
    
    .exercise-filters {
        gap: 6px;
    }
        }
    @media (max-width: 480px) {
        .clickable-exercise {
            font-size: var(--font-size-base);
            gap: var(--space-6);
            padding: var(--space-2) var(--space-6);
        }
        
        .pr-badge {
            font-size: var(--font-size-base);
            margin: 0 var(--space-1);
        }
        
        .clickable-exercise:hover {
            transform: translateX(var(--space-2));
        }
        
        .clickable-exercise .fa-external-link-alt {
            font-size: var(--font-size-sm);
        }
        
        .pr-badge[title]:hover::after {
            font-size: var(--font-size-xs);
            padding: var(--space-2) var(--space-6);
            margin-left: var(--space-8);
        }
        
        .exercise-sets-table th:last-child,
        .exercise-sets-table td:last-child {
            width: 50px;
        }
    }
        /* Animation for tab content */
        .tab-pane {
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }

        ::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* Week range styling */
        .week-range {
            font-weight: bold;
            color: #ffd166;
        }

        /* Workout volume styling */
        .workout-volume {
            color: #ffd166;
            font-weight: bold;
        }
        @media (max-width: 360px) {
    .navbar-brand.d-md-inline {
        display: none !important; /* Hide brand text completely */
    }
}
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-black">
        <div class="container">
            <div class="nav-logo-box">
                <a href="/">
                    <img src="static/images/trackyoulogo.png" alt="TrackYou Logo" class="nav-logo">
                </a>
            </div>
            <a class="navbar-brand d-md-inline" href="/" style="font-size: 13px; font-weight:600;">Track You</a>
            <a class="navbar-brand d-none d-md-inline" href="/" style="font-size: 12px;color: #ffffff; ">
                - Track, analyze, repeat -
            </a>
            <button class="btn-beta">BETA</button>
            <!-- Mobile Settings Dropdown (right-aligned) -->
            <div class="ms-auto d-block d-lg-none position-static d-flex align-items-center">
                <button class="mobile-settings-btn" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="bi bi-wrench-adjustable"></i>
                </button>
                <ul class="dropdown-menu dropdown-menu-end" 
                    aria-labelledby="navbarDropdownMobile"
                    style="position: absolute; background-color: #222; border: 1px solid #ffffff; border-radius: 5px; z-index: 1050; right: 15px; left: auto; font-size: 10;">
                    <li>
                        <a class="dropdown-item" 
                        href="/"
                        style="color: #e0e0e0; padding: 8px 15px;">
                            <i class="fa-solid fa-house-chimney-window me-2"></i><span data-i18n="home">Home</span>
                        </a>
                    </li>
                    <li>
                        <a class="dropdown-item" 
                        href="{{ url_for('workout') }}"
                        style="color: #e0e0e0; padding: 8px 15px;">
                            <i class="fas fa-dumbbell me-2"></i><span data-i18n="workouts">Workouts</span>
                        </a>
                    </li>
                    <li>
                        <a class="dropdown-item" 
                        href="/history"
                        style="color: #e0e0e0; padding: 8px 15px;">
                            <i class="fas fa-chart-pie me-2"></i><span data-i18n="history">History</span>
                        </a>
                    </li>
                    <li>
                        <a class="dropdown-item" 
                        href="{{ url_for('activity') }}"
                        style="color: #e0e0e0; padding: 8px 15px;">
                            <i class="fas fa-fire me-2"></i><span data-i18n="activity">Activity</span>
                        </a>
                    </li>
                    <li>
                        <a class="dropdown-item" 
                        href="/custom_food"
                        style="color: #e0e0e0; padding: 8px 15px;">
                            <i class="fas fa-file-circle-plus me-2"></i><span data-i18n="add_food">Add Food</span>
                        </a>
                    </li>
                    <li>
                        <a class="dropdown-item" 
                        href="{{ url_for('profile') }}"
                        style="color: #e0e0e0; padding: 8px 15px; border-bottom: 1px solid #444;">
                            <i class="fas fa-user-circle me-2"></i><span data-i18n="profile">Profile</span>
                        </a>
                    </li>
                    <li>
                        <a class="dropdown-item" 
                        href="{{ url_for('logout') }}"
                        style="color: #e0e0e0; padding: 8px 15px;">
                            <i class="fas fa-sign-out-alt me-2"></i><span data-i18n="logout">Logout</span>
                        </a>
                    </li>
                </ul>
            </div>
            
            <!-- Desktop Navigation -->
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link home-link nav-link-box" href="/" 
                        data-bs-toggle="tooltip" data-bs-placement="bottom" title="Home" data-i18n="tooltip_home" >
                            <i class="fa-solid fa-house-chimney-window"></i>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link workout-link nav-link-box" href="{{ url_for('workout') }}"
                        data-bs-toggle="tooltip" data-bs-placement="bottom" title="Workouts" data-i18n="tooltip_workouts">
                            <i class="fa-solid fa-dumbbell"></i>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link add-link nav-link-box" href="/custom_food"
                        data-bs-toggle="tooltip" data-bs-placement="bottom" title="Add Food" data-i18n="tooltip_add_food">
                            <i class="fa-solid fa-file-circle-plus"></i>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link history-link nav-link-box" href="/history"
                        data-bs-toggle="tooltip" data-bs-placement="bottom" title="History" data-i18n="tooltip_history">
                            <i class="fa-solid fa-chart-pie"></i>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link nav-link-box" href="/activity"
                        data-bs-toggle="tooltip" data-bs-placement="bottom" title="Activity" data-i18n="tooltip_activity">
                            <i class="fas fa-fire"></i>
                        </a>
                    </li>
                    
                    {% if current_user.is_authenticated %}
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle nav-link-box" 
                        href="#" 
                        id="navbarDropdownDesktop" 
                        role="button" 
                        data-bs-toggle="dropdown" 
                        aria-expanded="false"
                        data-bs-toggle="tooltip" data-bs-placement="bottom" title="Settings" data-i18n="tooltip_settings"
                        style="position: relative;">
                            <i class="bi bi-wrench-adjustable"></i>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" 
                            aria-labelledby="navbarDropdownDesktop"
                            style="background-color: #222; border: 1px solid #ffffff; border-radius: 5px;">
                            
                            <li>
                                <a class="dropdown-item" 
                                href="{{ url_for('profile') }}"
                                style="color: #e0e0e0; padding: 8px 15px; border-bottom: 1px solid #444;">
                                    <i class="fas fa-user-circle me-2"></i><span data-i18n="profile">Profile</span>
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" 
                                href="{{ url_for('logout') }}"
                                style="color: #e0e0e0; padding: 8px 15px;">
                                    <i class="fas fa-sign-out-alt me-2"></i><span data-i18n="logout">Logout</span>
                                </a>
                            </li>
                        </ul>
                    </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    <div class="history-container">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-title" data-i18n="nutrition_workout_history">Nutrition & Workout History</h1>
            <p class="page-subtitle" data-i18n="history_subtitle">Track your progress and analyze your performance over time</p>
        </div>

   <!-- Summary Stats Row -->
<div class="row mb-4">
  <!-- ✅ Today's Calories -->
<div class="col-md-3 col-6 mb-3">
    <div class="summary-card">
        <div class="summary-value text-warning">
            {% if today_calories >= 10000 %}
                {{ "%.1fk"|format(today_calories / 1000) }}
            {% else %}
                {{ today_calories | round(0) | int }}
            {% endif %}
        </div>
        <div class="summary-label" data-i18n="today_calories">Today's Calories</div>
    </div>
</div>

<!-- ✅ Today's Protein -->
    <div class="col-md-3 col-6 mb-3">
        <div class="summary-card">
            <!-- Weekly Avg Calories -->
            <div class="summary-value text-success">
                {% if weekly_data %}
                    {% set avg_cals = weekly_data[0].avg_calories %}
                    {% if avg_cals >= 10000 %}
                        {% set val = (avg_cals / 1000) | round(1) %}
                        {{ (val|string).replace('.0','') }}k
                    {% else %}
                        {{ avg_cals | round(0) }}
                    {% endif %}
                {% else %}
                    0
                {% endif %}
            </div>
            <div class="summary-label" data-i18n="weekly_avg_calories">Weekly Avg Calories</div>
    </div>
</div>

    <!-- ✅ Weekly Avg Calories + Current Balance (combined) -->
    <div class="col-md-3 col-6 mb-3">
        <div class="summary-card">

            <!-- Current Balance -->
            <div class="summary-value {% if daily_balance > 0 %}text-danger{% elif daily_balance < 0 %}text-success{% else %}text-muted{% endif %}">
                {% if daily_balance > 0 %}
                    +{% if daily_balance | abs >= 1000 %}
                        {% set val = (daily_balance / 1000) | round(1) %}
                        {{ (val|string).replace('.0','') }}k
                    {% else %}
                        {{ daily_balance | round(0) }}
                    {% endif %}
                {% elif daily_balance < 0 %}
                    {% if daily_balance | abs >= 1000 %}
                        {% set val = (daily_balance / 1000) | round(1) %}
                        {{ (val|string).replace('.0','') }}k
                    {% else %}
                        {{ daily_balance | round(0) }}
                    {% endif %}
                {% else %}
                    0
                {% endif %}
            </div>
            <div class="summary-label">
                {% if daily_balance > 0 %}
                    Kaloria yli kulutuksen
                {% elif daily_balance < 0 %}
                    Kaloria alle kulutuksen
                {% else %}
                    Ylläpitää painoa
                {% endif %}
            </div>
        </div>
    </div>

    <!-- ✅ Projected Weight Change -->
    <div class="col-md-3 col-6 mb-3">
        <div class="summary-card">
            <div class="summary-value {% if projected_change_kg > 0 %}text-warning{% elif projected_change_kg < 0 %}text-success{% else %}text-muted{% endif %}">
                {% if projected_change_kg > 0 %}
                    +{% if projected_change_kg | abs < 10 %}
                        {{ "%.1f"|format(projected_change_kg) }}kg
                    {% else %}
                        {{ projected_change_kg | round(0) | int }}kg
                    {% endif %}
                {% elif projected_change_kg < 0 %}
                    {% if projected_change_kg | abs < 10 %}
                        {{ "%.1f"|format(projected_change_kg) }}kg
                    {% else %}
                        {{ projected_change_kg | round(0) | int }}kg
                    {% endif %}
                {% else %}
                    0kg
                {% endif %}
            </div>
            <div class="summary-label">
                {% if projected_change_kg > 0 %}
                    Arvioitu painon nousu / viikko
                {% elif projected_change_kg < 0 %}
                    Arvioitu painon lasku / viikko
                {% else %}
                    Ei muutoksia odotettavissa
                {% endif %}
            </div>
        </div>
    </div>
</div>

        <!-- Main Content Card -->
        <div class="history-card">
            <div class="card-header-custom">
                <i class="fas fa-chart-line me-2"></i><span data-i18n="progress_tracking">Progress Tracking</span>
            </div>
            <div class="card-body">
                <ul class="nav nav-tabs" id="historyTabs" role="tablist">
                    <!-- Updated tab names as requested -->
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active btn-jerew" id="nutrition-tab" data-bs-toggle="tab" data-bs-target="#nutrition" type="button" role="tab">
                             <i class="fas fa-utensils me-1"></i> <span data-i18n="nutrition">Nutrition</span>
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link btn-jerew" id="workouts-tab" data-bs-toggle="tab" data-bs-target="#workouts" type="button" role="tab">
                            <i class="fas fa-dumbbell me-1"></i> <span data-i18n="workouts">Workouts</span>
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link btn-jerew" id="exercises-tab" data-bs-toggle="tab" data-bs-target="#exercises" type="button" role="tab">
                            <i class="fas fa-running me-1"></i> <span data-i18n="exercises">Exercises</span>
                        </button>
                    </li>
                </ul>
                
                <div class="tab-content">
                    <!-- Nutrition Tab (with nested tabs) -->
                    <div class="tab-pane fade show active" id="nutrition" role="tabpanel">
                        <ul class="nav nav-tabs" id="nutritionSubTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active btn-jere" id="daily-nutrition-tab" data-bs-toggle="tab" data-bs-target="#daily-nutrition" type="button" role="tab">
                                    <i class="fas fa-calendar-day me-1"></i> <span data-i18n="daily">Daily</span>
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link btn-jere" id="weekly-nutrition-tab" data-bs-toggle="tab" data-bs-target="#weekly-nutrition" type="button" role="tab">
                                     <i class="fas fa-calendar-week me-1"></i> <span data-i18n="weekly">Weekly</span>
                                </button>
                            </li>
                        </ul>
                        
                        <div class="tab-content mt-3">
                            <!-- Daily Nutrition Sub-tab -->
                            <div class="tab-pane fade show active" id="daily-nutrition" role="tabpanel">
                                {% if history_data and history_data|length > 0 %}
                                <div class="table-container">
                                    <table class="table table-custom table-hover">
                                        <thead>
                                            <tr>
                                                <th data-i18n="date">Date</th>
                                                <th data-i18n="calories">Calories</th>
                                                <th data-i18n="protein_g">Protein (g)</th>
                                                <th data-i18n="carbs_g">Carbs (g)</th>
                                                <th data-i18n="fats_g">Fats (g)</th>
                                                <th data-i18n="saturated_g">Saturated (g)</th>
                                                <th data-i18n="sugars_g">Sugars (g)</th>
                                                <th data-i18n="salt_g">Salt (g)</th>
                                                <th data-i18n="fiber_g">Fiber (g)</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for entry in history_data %}
                                            <tr>
                                               <td data-raw-date="{{ entry.date_raw }}">{{ entry.date }}</td>
                                                <td>{{ entry.calories | round(0) }}</td>
                                                <td>
                                                    {{ entry.proteins | round(0) }}
                                                    <div class="progress">
                                                        <div class="progress-bar progress-bar-protein" data-value="{{ entry.proteins }}"></div>
                                                    </div>
                                                </td>
                                                <td>
                                                    {{ entry.carbs | round(1) }}
                                                    <div class="progress">
                                                        <div class="progress-bar progress-bar-carbs" data-value="{{ entry.carbs }}"></div>
                                                    </div>
                                                </td>
                                                <td>
                                                    {{ entry.fats | round(1) }}
                                                    <div class="progress">
                                                        <div class="progress-bar progress-bar-fats" data-value="{{ entry.fats }}"></div>
                                                    </div>
                                                </td>
                                                    <td>
                                                    {{ entry.saturated | round(1) }}
                                                    <div class="progress">
                                                        <div class="progress-bar progress-bar-saturated" data-value="{{ entry.saturated }}"></div>
                                                    </div>
                                                </td>
                                                    <td>
                                                    {{ entry.sugars | round(1) }}
                                                    <div class="progress">
                                                        <div class="progress-bar progress-bar-sugars" data-value="{{ entry.sugars }}"></div>
                                                    </div>
                                                </td>
                                                <td>
                                                    {{ entry.salt | round(1) }}
                                                    <div class="progress">
                                                        <div class="progress-bar progress-bar-salt" data-value="{{ entry.salt }}"></div>
                                                    </div>
                                                </td>
                                                <td>
                                                    {{ entry.fiber | round(1) }}
                                                    <div class="progress">
                                                        <div class="progress-bar progress-bar-fiber" data-value="{{ entry.fiber }}"></div>
                                                    </div>
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                                {% else %}
                                <div class="empty-state">
                                    <i class="fas fa-utensils"></i>
                                    <h4 data-i18n="no_nutrition_data">No nutrition data available</h4>
                                    <p data-i18n="start_tracking_nutrition">Start tracking your meals to see your daily nutrition history</p>
                                    <a href="/custom_food" class="btn-jere mt-2" data-i18n="add_food">Add Food</a>
                                </div>
                                {% endif %}
                            </div>
                            
                            <!-- Weekly Nutrition Sub-tab -->
                            <div class="tab-pane fade" id="weekly-nutrition" role="tabpanel">
                                {% if weekly_data and weekly_data|length > 0 %}
                                <div class="table-container">
                                    <table class="table table-custom table-hover">
                                        <thead>
                                            <tr>
                                                <th style data-i18n="week">Week</th>
                                                <th data-i18n="avg_calories">Avg Calories</th>
                                                <th data-i18n="avg_protein_g">Avg Protein (g)</th>
                                                <th data-i18n="avg_carbs_g">Avg Carbs (g)</th>
                                                <th data-i18n="avg_fats_g">Avg Fats (g)</th>
                                                <th data-i18n="avg_saturated_g">Avg Saturated (g)</th>
                                                <th data-i18n="avg_sugars_g">Avg Sugars (g)</th>
                                                <th data-i18n="avg_salt_g">Avg Salt (g)</th>
                                                <th data-i18n="avg_fiber_g">Avg Fiber (g)</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for week in weekly_data %}
                                            <tr>
                                                <td>
                                                    
                                                    <small>{{ week.start_date }} to {{ week.end_date }}</small>
                                                </td>
                                                <td>{{ week.avg_calories | round(1) }}</td>
                                                <td>{{ week.avg_proteins | round(1) }}</td>
                                                <td>{{ week.avg_carbs | round(1) }}</td>
                                                <td>{{ week.avg_fats | round(1) }}</td>
                                                <td>{{ week.avg_saturated | round(1) }}</td>
                                                <td>{{ week.avg_sugars | round(1) }}</td>
                                                <td>{{ week.avg_salt | round(1) }}</td>
                                                <td>{{ week.avg_fiber | round(1) }}</td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                                {% else %}
                                <div class="empty-state">
                                    <i class="fas fa-chart-bar"></i>
                                    <h4 data-i18n="no_weekly_data">No weekly data available</h4>
                                    <p data-i18n="keep_tracking_weekly">Keep tracking your meals to see weekly nutrition trends</p>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                           
                    <!-- Workout History Tab -->
                    <div class="tab-pane fade" id="workouts" role="tabpanel">
                        <div class="p-3">
                            <!-- Sub-tabs for Daily / Weekly / Monthly -->
                            <ul class="nav nav-tabs workout-subtabs" id="workoutHistoryTabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active btn-jere" id="daily-workout-tab" data-bs-toggle="tab" data-bs-target="#daily-workout" type="button" role="tab" data-i18n="daily">Daily</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link btn-jere" id="weekly-workout-tab" data-bs-toggle="tab" data-bs-target="#weekly-workout" type="button" role="tab" data-i18n="weekly">Weekly</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link btn-jere" id="monthly-workout-tab" data-bs-toggle="tab" data-bs-target="#monthly-workout" type="button" role="tab" data-i18n="monthly">Monthly</button>
                                </li>
                            </ul>

                            <!-- Tab content -->
                            <div class="tab-content mt-3">
                                <!-- DAILY -->
                                <div class="tab-pane fade show active" id="daily-workout" role="tabpanel">
                                    <!-- List View -->
                                    <div id="daily-workout-list">
                                        <!-- Will be populated by JavaScript -->
                                    </div>

                                    <!-- Detail View (initially hidden) -->
                                    <div id="daily-workout-detail" class="workout-detail-view">
                                        <div class="workout-detail-header">
                                            <div>
                                                <div class="workout-detail-title" id="daily-detail-title">Monday, 16/09</div>
                                                <div class="workout-detail-subtitle" data-i18n="workout_details">Workout Details</div>
                                            </div>
                                            <button id="back-to-daily-list" class="btn-jere">
                                                <i class="fas fa-arrow-left me-1"></i> <span data-i18n="backk">Back</span>
                                            </button>
                                        </div>

                                                                            <!-- Summary Cards -->
                                            <div class="workout-summary-cards">
                                                <div class="workout-summary-card sessions">
                                                    <i class="fas fa-play-circle card-icon"></i>
                                                    <div class="card-title" data-i18n="sessions">Sessions</div>
                                                    <div class="card-value" id="daily-detail-sessions">0</div>
                                                </div>
                                                <div class="workout-summary-card duration">
                                                    <i class="fas fa-clock card-icon"></i>
                                                    <div class="card-title" data-i18n="duration">Duration</div>
                                                    <div class="card-value" id="daily-detail-duration">0m</div>
                                                </div>
                                                <div class="workout-summary-card calories">
                                                    <i class="fas fa-fire card-icon"></i>
                                                    <div class="card-title" data-i18n="calories">Calories</div>
                                                    <div class="card-value" id="daily-detail-calories">0</div>
                                                </div>
                                                <div class="workout-summary-card muscle-groups">
                                                    <i class="fas fa-dumbbell card-icon"></i>
                                                    <div class="card-title" data-i18n="muscle_groups">Muscle Groups</div>
                                                    <div class="card-value" id="daily-detail-muscle-groups">0</div>
                                                </div>
                                                <div class="workout-summary-card sets">
                                                    <i class="fas fa-layer-group card-icon"></i>
                                                    <div class="card-title" data-i18n="sets">Sets</div>
                                                    <div class="card-value" id="daily-detail-sets">0</div>
                                                </div>
                                                <div class="workout-summary-card reps">
                                                    <i class="fas fa-redo card-icon"></i>
                                                    <div class="card-title" data-i18n="reps">Reps</div>
                                                    <div class="card-value" id="daily-detail-reps">0</div>
                                                </div>
                                                <div class="workout-summary-card volume">
                                                    <i class="fas fa-weight-hanging card-icon"></i>
                                                    <div class="card-title" data-i18n="volume">Volume</div>
                                                    <div class="card-value" id="daily-detail-volume">0 kg</div>
                                                </div>
                                            </div>

                                        <!-- Muscle Group Details -->
                                        <div class="muscle-group-details">
                                            <h5><i class="fas fa-dumbbell me-2"></i><span data-i18n="muscle_group_breakdown">Muscle Group Breakdown</span></h5>
                                            <div id="daily-detail-muscle-breakdown">
                                                <!-- Will be populated by JavaScript -->
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- WEEKLY -->
                                <div class="tab-pane fade" id="weekly-workout" role="tabpanel">
                                    <!-- List View -->
                                    <div id="weekly-workout-list">
                                        <!-- Will be populated by JavaScript -->
                                    </div>

                                    <!-- Detail View (initially hidden) -->
                                    <div id="weekly-workout-detail" class="workout-detail-view">
                                        <div class="workout-detail-header">
                                            <div>
                                                <div class="workout-detail-title" id="weekly-detail-title">Week 16 Sep - 22 Sep</div>
                                                <div class="workout-detail-subtitle" data-i18n="weekly_workout_details">Weekly Workout Details</div>
                                            </div>
                                            <button id="back-to-weekly-list" class="btn-jere">
                                                <i class="fas fa-arrow-left me-1"></i> <span data-i18n="backk">Back</span>
                                            </button>
                                        </div>

                                                <!-- Summary Cards -->
                                                <div class="workout-summary-cards">
                                                    <div class="workout-summary-card sessions">
                                                        <i class="fas fa-play-circle card-icon"></i>
                                                        <div class="card-title" data-i18n="sessions">Sessions</div>
                                                        <div class="card-value" id="weekly-detail-sessions">0</div>
                                                    </div>
                                                    <div class="workout-summary-card duration">
                                                        <i class="fas fa-clock card-icon"></i>
                                                        <div class="card-title" data-i18n="duration">Kesto</div>
                                                        <div class="card-value" id="weekly-detail-duration">0m</div>
                                                    </div>
                                                    <div class="workout-summary-card calories">
                                                        <i class="fas fa-fire card-icon"></i>
                                                        <div class="card-title" data-i18n="calories">Kalorit</div>
                                                        <div class="card-value" id="weekly-detail-calories">0</div>
                                                    </div>
                                                    <div class="workout-summary-card muscle-groups">
                                                        <i class="fas fa-dumbbell card-icon"></i>
                                                        <div class="card-title" data-i18n="muscle_groups">Muscle Groups</div>
                                                        <div class="card-value" id="weekly-detail-muscle-groups">0</div>
                                                    </div>
                                                    <div class="workout-summary-card sets">
                                                        <i class="fas fa-layer-group card-icon"></i>
                                                        <div class="card-title" data-i18n="sets">Sets</div>
                                                        <div class="card-value" id="weekly-detail-sets">0</div>
                                                    </div>
                                                    <div class="workout-summary-card reps">
                                                        <i class="fas fa-redo card-icon"></i>
                                                        <div class="card-title" data-i18n="reps">Reps</div>
                                                        <div class="card-value" id="weekly-detail-reps">0</div>
                                                    </div>
                                                    <div class="workout-summary-card volume">
                                                        <i class="fas fa-weight-hanging card-icon"></i>
                                                        <div class="card-title" data-i18n="volume">Volume</div>
                                                        <div class="card-value" id="weekly-detail-volume">0 kg</div>
                                                    </div>
                                                </div>

                                        <!-- Muscle Group Details -->
                                        <div class="muscle-group-details">
                                            <h5><i class="fas fa-dumbbell me-2"></i><span data-i18n="muscle_group_breakdown">Muscle Group Breakdown</span></h5>
                                            <div id="weekly-detail-muscle-breakdown">
                                                <!-- Will be populated by JavaScript -->
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- MONTHLY -->
                                <div class="tab-pane fade" id="monthly-workout" role="tabpanel">
                                    <!-- List View -->
                                    <div id="monthly-workout-list">
                                        <!-- Will be populated by JavaScript -->
                                    </div>

                                    <!-- Detail View (initially hidden) -->
                                    <div id="monthly-workout-detail" class="workout-detail-view">
                                        <div class="workout-detail-header">
                                            <div>
                                                <div class="workout-detail-title" id="monthly-detail-title">September 2024</div>
                                                <div class="workout-detail-subtitle" data-i18n="monthly_workout_details">Monthly Workout Details</div>
                                            </div>
                                            <button id="back-to-monthly-list" class="btn-jere">
                                                <i class="fas fa-arrow-left me-1"></i> <span data-i18n="backk">Back</span>
                                            </button>
                                        </div>

                                                    <!-- Summary Cards -->
                                        <div class="workout-summary-cards">
                                            <div class="workout-summary-card sessions">
                                                <i class="fas fa-play-circle card-icon"></i>
                                                <div class="card-title" data-i18n="sessions">Sessions</div>
                                                <div class="card-value" id="monthly-detail-sessions">0</div>
                                            </div>
                                            <div class="workout-summary-card duration">
                                                <i class="fas fa-clock card-icon"></i>
                                                <div class="card-title" data-i18n="duration">Aika</div>
                                                <div class="card-value" id="monthly-detail-duration">0m</div>
                                            </div>
                                            <div class="workout-summary-card calories">
                                                <i class="fas fa-fire card-icon"></i>
                                                <div class="card-title" data-i18n="calories">Calories</div>
                                                <div class="card-value" id="monthly-detail-calories">0</div>
                                            </div>
                                            <div class="workout-summary-card muscle-groups">
                                                <i class="fas fa-dumbbell card-icon"></i>
                                                <div class="card-title" data-i18n="muscle_groups">Muscle Groups</div>
                                                <div class="card-value" id="monthly-detail-muscle-groups">0</div>
                                            </div>
                                            <div class="workout-summary-card sets">
                                                <i class="fas fa-layer-group card-icon"></i>
                                                <div class="card-title" data-i18n="sets">Sets</div>
                                                <div class="card-value" id="monthly-detail-sets">0</div>
                                            </div>
                                            <div class="workout-summary-card reps">
                                                <i class="fas fa-redo card-icon"></i>
                                                <div class="card-title" data-i18n="reps">Reps</div>
                                                <div class="card-value" id="monthly-detail-reps">0</div>
                                            </div>
                                            <div class="workout-summary-card volume">
                                                <i class="fas fa-weight-hanging card-icon"></i>
                                                <div class="card-title" data-i18n="volume">Volume</div>
                                                <div class="card-value" id="monthly-detail-volume">0 kg</div>
                                            </div>
                                        </div>

                                        <!-- Muscle Group Details -->
                                        <div class="muscle-group-details">
                                            <h5><i class="fas fa-dumbbell me-2"></i><span data-i18n="muscle_group_breakdown">Muscle Group Breakdown</span></h5>
                                            <div id="monthly-detail-muscle-breakdown">
                                                <!-- Will be populated by JavaScript -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Exercises Tab -->
<div class="tab-pane fade" id="exercises" role="tabpanel">
    <div class="p-3">
        <!-- Exercise Search and Filter Container with webkit styling -->
        <div class="exercise-search-filter-container mb-3">
            <!-- Search Input -->
            <div class="exercise-search-wrapper">
                <input type="text" id="exercise-search" class="exercise-search-input" placeholder="Search exercises..." data-i18n="search_exercises_placeholder">
                <i class="fas fa-search exercise-search-icon"></i>
            </div>
            
            <!-- Muscle Group Filters -->
            <div class="exercise-filters" id="muscle-group-filters">
                <button class="muscle-group-filter active" data-muscle="all" data-i18n="all">All</button>
                <button class="muscle-group-filter" data-muscle="chest" data-i18n="chest">Chest</button>
                <button class="muscle-group-filter" data-muscle="back" data-i18n="back">Back</button>
                <button class="muscle-group-filter" data-muscle="shoulders" data-i18n="shoulders">Shoulders</button>
                <button class="muscle-group-filter" data-muscle="arms" data-i18n="arms">Arms</button>
                <button class="muscle-group-filter" data-muscle="legs" data-i18n="legs">Legs</button>
                <button class="muscle-group-filter" data-muscle="core" data-i18n="core">Core</button>
            </div>
        </div>
        
        <!-- Exercise Table with clickable headers -->
        <div class="table-responsive">
            <table class="table table-custom table-hover">
                <thead>
                    <tr>
                        <th class="sortable-header" data-sort="name" data-i18n="exercise">
                            Liike <i class="fas fa-sort sort-icon"></i>
                        </th>
                        <th class="sortable-header text-end" data-sort="pb">
                            Personal Best <i class="fas fa-sort sort-icon"></i>
                        </th>
                        <th class="sortable-header text-end" data-sort="volume">
                            Kokonais Volyymi <i class="fas fa-sort sort-icon"></i>
                        </th>
                        <th class="sortable-header text-end" data-sort="trend">
                            Trendi <i class="fas fa-sort sort-icon"></i>
                        </th>
                    </tr>
                </thead>
                <tbody id="exercises-list">
                    <!-- Will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
        
        <!-- Exercise Detail View (initially hidden) -->
        <div id="exercise-detail" class="mt-4" style="display: none;">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h4 id="exercise-detail-name" class="mb-0"></h4>
                <button id="back-to-list" class="btn-jere">
                    <i class="fas fa-arrow-left me-1"></i> <span data-i18n="back_to_list">Back to List</span>
                </button>
            </div>

            <!-- Summary Cards -->
            <div class="row mb-4">
                <!-- Volume Card -->
                <div class="col-md-3 mb-3">
                    <div class="summary-card">
                        <div class="summary-value text-primary" id="exercise-monthly-volume">0 kg</div>
                       <div class="summary-label" data-i18n="monthly_volume">MONTHLY VOLUME</div>
                    </div>
                </div>
                <!-- Personal Best Card -->
                <div class="col-md-3 mb-3">
                    <div class="summary-card">
                        <div class="summary-value text-warning" id="exercise-personal-best">0 kg</div>
                        <div class="summary-label" data-i18n="personal_best">PERSONAL BEST</div>
                    </div>
                </div>
                <!-- Best Set Card -->
                <div class="col-md-3 mb-3">
                    <div class="summary-card">
                        <div class="summary-value text-info" id="exercise-best-set">-</div>
                     <div class="summary-label" data-i18n="best_set">BEST SET</div>
                    </div>
                </div>
                <!-- Ranking Card with 1RM -->
                <div class="col-md-3 mb-3">
                    <div class="summary-card">
                        <div class="summary-value text-success" id="exercise-ranking">-</div>
                      <div class="summary-label" data-i18n="estimated_1rm">ESTIMATED 1 RM</div>
                    </div>
                </div>
            </div>

            <!-- Chart -->
            <div class="chart-container mb-4" style="position: relative; height: 250px;">
                <canvas id="exercise-chart"></canvas>
            </div>

            <!-- Session History -->
            <h5 class="mb-3" data-i18n="session_history">Session History</h5>
            <div class="table-responsive">
                <table class="table table-custom">
                    <thead>
                        <tr>
                           <th data-i18n="date">Date</th>
                         <th class="text-end" data-i18n="sets">Sets</th>
                     <th class="text-end" data-i18n="best_set">Best Set</th>
                      <th class="text-end" data-i18n="volume">Volume</th>
                        </tr>
                    </thead>
                    <tbody id="exercise-sessions">
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

    <!-- JS dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        let currentSort = { field: 'name', direction: 'asc' };
        let exerciseChart = null;
        let allExercises = [];
         
    $(document).ready(function() {
        

            setTimeout(function() {
        localiseNutritionDates();
    }, 100);

        function formatDateLocalized(dateString) {
    const date = new Date(dateString);
    if (isNaN(date)) return dateString;

    const weekdayKey = date.toLocaleDateString('en-US', { weekday: 'short' }).toLowerCase();
    const monthKey = date.toLocaleDateString('en-US', { month: 'long' }).toLowerCase();

    console.log('Date:', dateString, 'WeekdayKey:', weekdayKey, 'MonthKey:', monthKey);
    
    const weekday = translateWeekday(weekdayKey);
    const month = translateMonth(monthKey);
    
    console.log('Translated weekday:', weekday, 'Translated month:', month);

    return `${weekday} ${date.getDate()} ${month} ${date.getFullYear()}`;
}

function localiseNutritionDates() {
    $('#daily-nutrition tbody tr').each(function () {
        const $first = $(this).find('td:first');
        const rawDate = $first.data('raw-date');  // Get raw date from data attribute
        if (rawDate) {
            $first.text(formatDateLocalized(rawDate));
        }
    });
    /* --- Weekly nutrition table --- */
    $('#weekly-nutrition tbody tr').each(function () {
        const $range = $(this).find('small'); // contains "2025-09-01 to 2025-09-07"
        if ($range.length === 0) return;

        const raw      = $range.text().trim();
        const [startRaw, endRaw] = raw.split(' to ');
        if (!endRaw) return; // unexpected format – skip

        const startLocal = formatDateLocalized(startRaw.trim());
        const endLocal   = formatDateLocalized(endRaw.trim());

        $range.text(`${startLocal} – ${endLocal}`); // en-dash between dates
    });
}
    // --- Update progress bars & localize dates when nutrition tab is shown ---
   $('#nutrition-tab').on('shown.bs.tab', function() {
    updateProgressBarsWithTargets();
    setTimeout(function() {
        localiseNutritionDates();
    }, 50);
});

// --- On page load if nutrition tab is active ---
if ($('#nutrition-tab').hasClass('active')) {
    updateProgressBarsWithTargets();
    setTimeout(function() {
        localiseNutritionDates();
    }, 100);
}

// --- Update progress bars & localize dates when switching daily/weekly sub-tabs ---
$('#daily-nutrition-tab, #weekly-nutrition-tab').on('shown.bs.tab', function() {
    updateProgressBarsWithTargets();
    setTimeout(function() {
        localiseNutritionDates();
    }, 50);
});
});
        
        // Helper function to translate exercise names
        function formatDateForAPI(dateInput) {
    if (!dateInput) return null;
    
    // If it's already in YYYY-MM-DD format, return as is
    if (/^\d{4}-\d{2}-\d{2}$/.test(dateInput)) {
        return dateInput;
    }
    
    try {
        const date = new Date(dateInput);
        // Check if date is valid
        if (isNaN(date.getTime())) {
            return null;
        }
        
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
    } catch (e) {
        console.error('Date formatting error:', e, dateInput);
        return null;
    }
}
        function translateExerciseName(exerciseName) {
            return t(exerciseName) !== exerciseName ? t(exerciseName) : exerciseName;
        }

        // Helper function to translate muscle groups
        function translateMuscleGroup(muscleGroup) {
    if (!muscleGroup) return 'N/A';
    const lowercased = muscleGroup.toLowerCase().trim();
    
    // Map common muscle group variations to translation keys
    const muscleMap = {
        'chest': 'chest',
        'back': 'back',
        'legs': 'legs',
        'shoulders': 'shoulders',
        'arms': 'arms',
        'core': 'core',
        'rinta': 'chest',
        'selkä': 'back', 
        'jalat': 'legs',
        'olkapäät': 'shoulders',
        'kädet': 'arms',
        'vatsa': 'core'
    };
    
    const key = muscleMap[lowercased];
    return key ? t(key) : muscleGroup;
}


        // CSRF TOKEN //
        $.ajaxSetup({
            beforeSend: function(xhr, settings) {
                let token = $('meta[name="csrf-token"]').attr('content');
                if (token) {
                    xhr.setRequestHeader("X-CSRFToken", token);
                }
            }
        });
        
        // Initialize workout history when Workouts tab is activated
        $('#workouts-tab').on('shown.bs.tab', function() {
            loadWorkoutHistory('daily');
        });
        
        // Initialize exercises tab
        $('#exercises-tab').on('shown.bs.tab', function() {
            loadExercises();
        });

        // Back to list button
        $('#back-to-list').click(function() {
            $('#exercise-detail').hide();
            $('#exercises-list').closest('.table-responsive').show();
        });

        // Back to workout list buttons
        $('#back-to-daily-list').click(function() {
            $('#daily-workout-detail').hide();
            $('#daily-workout-list').show();
        });

        $('#back-to-weekly-list').click(function() {
            $('#weekly-workout-detail').hide();
            $('#weekly-workout-list').show();
        });

        $('#back-to-monthly-list').click(function() {
            $('#monthly-workout-detail').hide();
            $('#monthly-workout-list').show();
        });

        // Clickable header sorting
        $(document).on('click', '.sortable-header', function() {
             const sortField = $(this).data('sort');
            
            // Update sort direction
                if (currentSort.field === sortField) {
                    currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
                } else {
                    currentSort.field = sortField;
                    currentSort.direction = 'asc';
                }
    
            
            // Update header visual state
            $('.sortable-header').removeClass('active asc desc');
            $(this).addClass(`active ${currentSort.direction}`);
            
            // Apply sort
            sortExercises(sortField, currentSort.direction);
        });
        function smartKg(value) {
    if (value == null) return '0 kg';
    const rounded = Math.round(value * 10) / 10; // 1 decimal
    return (Number.isInteger(rounded) ? rounded : rounded.toFixed(1)) + ' kg';
}
function smartPercent(value) {
    if (value == null) return '0%';
    const rounded = Math.round(value * 10) / 10; // 1 decimal
    return (Number.isInteger(rounded) ? rounded : rounded.toFixed(1)) + '%';
}
       // Muscle group filter handler
let currentMuscleFilter = 'all';

$(document).on('click', '.muscle-group-filter', function() {
    $('.muscle-group-filter').removeClass('active');
    $(this).addClass('active');
    currentMuscleFilter = $(this).data('muscle').toLowerCase().trim();
    applyMuscleFilter();
});

function applyMuscleFilter() {
    $('.exercise-row').each(function() {
        const muscle = $(this).data('muscle').toLowerCase().trim();
        if (currentMuscleFilter === 'all' || muscle === currentMuscleFilter) {
            $(this).show();
        } else {
            $(this).hide();
        }
    });
}
        // Search functionality
           $(document).on('input', '#exercise-search', function() {
    const searchTerm = $(this).val().toLowerCase();
    $('.exercise-row').each(function() {
        // Get both the raw database name and the translated display name
        const exerciseNameRaw = $(this).data('name').toLowerCase();
        const exerciseNameTranslated = translateExerciseName($(this).data('name')).toLowerCase();
        
        // Check if search term matches either raw name or translated name
        const matchesRaw = exerciseNameRaw.includes(searchTerm);
        const matchesTranslated = exerciseNameTranslated.includes(searchTerm);
        
        // Show row if either name matches
        $(this).toggle(matchesRaw || matchesTranslated);
    });
});
        
        // Sort exercises based on criteria
        function sortExercises(criteria, direction = 'asc') {
    console.log('Sorting exercises by:', criteria, direction); // Debug log
    
    if (!allExercises || allExercises.length === 0) {
        console.warn('No exercises to sort');
        return;
    }
    
    const sorted = [...allExercises];
    
    sorted.sort((a, b) => {
        let valueA, valueB;
        
        switch(criteria) {
            case 'name':
                valueA = (a.name || '').toLowerCase();
                valueB = (b.name || '').toLowerCase();
                break;
            case 'pb':
                valueA = parseFloat(a.personal_best) || 0;
                valueB = parseFloat(b.personal_best) || 0;
                break;
            case 'volume':
                valueA = parseFloat(a.total_volume) || 0;
                valueB = parseFloat(b.total_volume) || 0;
                break;
            case 'trend':
                valueA = parseFloat(a.volume_trend) || 0;
                valueB = parseFloat(b.volume_trend) || 0;
                break;
            default:
                console.warn('Unknown sort criteria:', criteria);
                return 0;
        }
        
        if (typeof valueA === 'string') {
            const comparison = valueA.localeCompare(valueB);
            return direction === 'asc' ? comparison : -comparison;
        } else {
            const comparison = valueA - valueB;
            return direction === 'asc' ? comparison : -comparison;
        }
    });
    
    console.log('Sorted exercises:', sorted.length); // Debug log
    renderExercisesList(sorted);
}


        // Load exercises list
        function loadExercises() {
    $.get('/workout/exercises', function(data) {
        console.log('Loaded exercises:', data.exercises.length); // Debug log
        allExercises = data.exercises;
        
        // Apply default sort
        sortExercises('name', 'asc');
    }).fail(function(xhr, status, error) {
        console.error('Failed to load exercises:', error);
        $('#exercises-list').html(`
            <tr>
                <td colspan="4" class="text-center py-4 text-warning">
                    Failed to load exercises. Please try again.
                </td>
            </tr>
        `);
    });
}


        // Render exercises list
        function renderExercisesList(exercises) {
    const container = $("#exercises-list");
    container.empty();

    if (!exercises || exercises.length === 0) {
        container.append(`
            <tr>
                <td colspan="4" class="text-center py-4">No exercises found</td>
            </tr>
        `);
        return;
    }

    console.log('Rendering exercises:', exercises.length); // Debug log

    exercises.forEach(ex => {
        // Get volume trend from backend data
        const volumeTrend = parseFloat(ex.volume_trend) || 0;
        const trendClass = volumeTrend > 0 ? 'text-success' : 
                          volumeTrend < 0 ? 'text-danger' : 'text-muted';
        const trendIcon = volumeTrend > 0 ? 'fa-arrow-up' : 
                         volumeTrend < 0 ? 'fa-arrow-down' : 'fa-minus';
        
        const row = `
            <tr class="exercise-row" data-id="${ex.id}" data-name="${ex.name}" data-muscle="${ex.muscle_group || 'N/A'}">
                <td>
                    <strong>${translateExerciseName(ex.name)}</strong><br>
                    <small class="text-muted">${translateMuscleGroup(ex.muscle_group)}</small>
                </td>
                <td class="text-end align-middle">
                    <span class="badge bg-warning text-dark">${Math.round(ex.personal_best || 0)} kg</span>
                </td>
                <td class="text-end align-middle">${(ex.total_volume || 0).toFixed(1)} kg</td>
                <td class="text-end align-middle">
                    <span class="${trendClass}">
                        <i class="fas ${trendIcon} me-1"></i>
                        ${Math.abs(volumeTrend).toFixed(1)}%
                    </span>
                </td>
            </tr>`;
        container.append(row);
    });

    // Apply the active muscle filter after rendering
    applyMuscleFilter();

    // Add click handlers for exercise rows
    $('.exercise-row').off('click').on('click', function() {
        const exerciseId = $(this).data('id');
        loadExerciseDetail(exerciseId);
    });
}


        // Load exercise detail
        function loadExerciseDetail(exerciseId) {
            $.get(`/workout/exercise/${exerciseId}`, function(data) {
                renderExerciseDetail(data);
            }).fail(function() {
                alert(t("failed_load_exercise_details"));
            });
        }

        // Safe parsing of weight/reps from strings like "64kg" or "10"
        function parseBestSet(rawSet) {
            if (!rawSet) return null;

            // If already object
            if (typeof rawSet === 'object' && rawSet.weight && rawSet.reps) {
                const weight = parseFloat(rawSet.weight);
                const reps = parseInt(rawSet.reps);
                if (isNaN(weight) || isNaN(reps) || reps <= 0) return null;
                return { weight, reps };
            }

            if (typeof rawSet === 'string') {
                // Match formats like "180kg × 5" or "180kg x 5"
                const match = rawSet.match(/(\\d+(\\.\\d+)?)\\s*kg\\s*[×x]\\s*(\\d+)/i);
                if (!match) return null;
                const weight = parseFloat(match[1]);
                const reps = parseInt(match[3]);
                if (isNaN(weight) || isNaN(reps) || reps <= 0) return null;
                return { weight, reps };
            }

            return null;
        }
        
        function calculateOneRepMax(weight, reps) {
            weight = parseFloat(weight);
            reps = parseInt(reps);
            if (isNaN(weight) || isNaN(reps) || reps <= 0) return 0;

            if (reps === 1) return weight;

            const denom = 1.0278 - 0.0278 * reps;
            if (denom <= 0) return 0; // prevent negative or zero denominator
            return weight / denom;
        }

        // Render exercise detail (chart + session table)
        // ---------- Smart formatting helpers ----------
function smartKg(value) {
    if (value == null) return '0 kg';
    const rounded = Math.round(value * 10) / 10; // 1 decimal
    return (Number.isInteger(rounded) ? rounded : rounded.toFixed(1)) + ' kg';
}

function smartPercent(value) {
    if (value == null) return '0%';
    const rounded = Math.round(value * 10) / 10; // 1 decimal
    return (Number.isInteger(rounded) ? rounded : rounded.toFixed(1)) + '%';
}

// ---------- Render exercise detail ----------
function renderExerciseDetail(data) {
    // Exercise name
    $('#exercise-detail-name').text(translateExerciseName(data.name));

    // Summary cards
    $('#exercise-personal-best').text(smartKg(data.personal_best || 0));
    $('#exercise-monthly-volume').text(smartKg(data.monthly_volume || 0));
    $('#exercise-best-set').text(data.best_set.formatted || '-');

// Calculate 1RM from structured data
if (data.best_set.weight > 0 && data.best_set.reps > 0) {
    const oneRepMax = calculateOneRepMax(data.best_set.weight, data.best_set.reps);
    $('#exercise-ranking').text(smartKg(oneRepMax));
} else {
    $('#exercise-ranking').text('-');
}

    // Chart
    renderExerciseChart(data.history);

    // Session table
    renderSessionsTable(data.history);

    // Show detail view and hide exercises list
    $('#exercises-list').closest('.table-responsive').hide();
    $('#exercise-detail').show();
}
        // Updated showWorkoutDetail function to make muscle groups clickable
 function showWorkoutDetail(period, item) {
    const detailContainer = `#${period}-workout-detail`;
    const listContainer = `#${period}-workout-list`;
    
    // Hide list and show detail
    $(listContainer).hide();
    $(detailContainer).show();

    // Update detail header
    let periodLabel = '';
    let dateFilter = '';
    let weekStart = '';
    let monthStart = '';

    if (period === 'daily') {
        const date = new Date(item.date);
        const weekday = date.toLocaleDateString('en-US', { weekday: 'long' }).toLowerCase();
        const translatedWeekday = translateWeekday(weekday);
        const monthName = translateMonth(date.toLocaleDateString('en-US', {month:'long'}).toLowerCase());
        periodLabel = `${translatedWeekday}, ${date.getDate()} ${monthName}`;
        dateFilter = item.date;
    } else if (period === 'weekly') {
        const startDate = new Date(item.week_start);
        const weekEnd = new Date(startDate); 
        weekEnd.setDate(weekEnd.getDate() + 6);
        const startMonth = translateMonth(startDate.toLocaleDateString('en-US', {month:'long'}).toLowerCase());
        const endMonth = translateMonth(weekEnd.toLocaleDateString('en-US', {month:'long'}).toLowerCase());
        periodLabel = `${startDate.getDate()} ${startMonth} - ${weekEnd.getDate()} ${endMonth}`;
        weekStart = item.week_start;
    } else {
        const startDate = new Date(item.month_start);
        const monthName = translateMonth(startDate.toLocaleDateString('en-US', {month:'long'}).toLowerCase());
        periodLabel = `${monthName} ${startDate.getFullYear()}`;
        monthStart = item.month_start;
    }

    $(`#${period}-detail-title`).text(periodLabel);

    // Update summary cards
    const muscleGroupCount = Object.keys(item.muscles || {}).length;
    $(`#${period}-detail-sessions`).text(item.sessions_count || 0);
    $(`#${period}-detail-muscle-groups`).text(muscleGroupCount);
    $(`#${period}-detail-sets`).text(item.total_sets || 0);
    $(`#${period}-detail-reps`).text(item.total_reps || 0);
    $(`#${period}-detail-volume`).text(parseFloat(item.total_volume || 0).toLocaleString() + ' kg');
    $(`#${period}-detail-duration`).text(item.duration_formatted || '0m');
    $(`#${period}-detail-calories`).text(Math.round(item.calories_burned || 0));

    // Updated muscle breakdown with clickable cards
const muscleBreakdownContainer = $(`#${period}-detail-muscle-breakdown`);
muscleBreakdownContainer.empty();

if (item.muscles && Object.keys(item.muscles).length > 0) {
    Object.entries(item.muscles).forEach(([muscle, stats]) => {
        const muscleId = `muscle-${muscle.replace(/\s+/g, '-')}-${period}`;
        
        const muscleCardHtml = `
            <div class="muscle-detail-card" 
                 data-muscle="${muscle}" 
                 data-period="${period}" 
                 data-date="${dateFilter || ''}" 
                 data-week-start="${weekStart || ''}" 
                 data-month-start="${monthStart || ''}">
                <div class="muscle-name">
                    ${translateMuscleGroup(muscle)}
                    <i class="fas fa-chevron-down muscle-collapse-icon"></i>
                </div>
                <div class="muscle-stats">
                    <div class="muscle-stat">
                        <div class="muscle-stat-value">${stats.total_sets || 0}</div>
                        <div class="muscle-stat-label">${t('sets')}</div>
                    </div>
                    <div class="muscle-stat">
                        <div class="muscle-stat-value">${stats.total_reps || 0}</div>
                        <div class="muscle-stat-label">${t('reps')}</div>
                    </div>
                    <div class="muscle-stat">
                        <div class="muscle-stat-value">${parseFloat(stats.total_volume || 0).toFixed(0)}</div>
                        <div class="muscle-stat-label">kg</div>
                    </div>
                </div>
                <div id="${muscleId}-details" class="exercise-detail-section" style="display: none;">
                    <!-- Exercise details will be loaded here -->
                </div>
            </div>
        `;
        
        muscleBreakdownContainer.append(muscleCardHtml);
    });
    
    // ✅ CRITICAL FIX: Add click handlers AFTER cards are appended to DOM
    muscleBreakdownContainer.find('.muscle-detail-card').each(function() {
    const card = $(this);
    
    // Remove click handler from entire card
    card.off('click');
    
    // Add click handler ONLY to the muscle name header
    card.find('.muscle-name').off('click').on('click', function(e) {
        // Prevent event bubbling
        e.stopPropagation();
        
        const muscle = card.data('muscle');
        const period = card.data('period');
        const date = card.data('date');
        const weekStart = card.data('week-start');
        const monthStart = card.data('month-start');
        const muscleId = `muscle-${muscle.replace(/\s+/g, '-')}-${period}`;
        const detailSection = $(`#${muscleId}-details`);
        
        if (card.hasClass('expanded')) {
            // Collapse
            card.removeClass('expanded');
            detailSection.slideUp(300);
        } else {
            // Expand and load details
            card.addClass('expanded');
            detailSection.slideDown(300);
            loadMuscleExerciseDetails(muscle, period, date, weekStart, monthStart, muscleId);
        }
    });
});
} else {
    muscleBreakdownContainer.html(`
        <div class="text-center text-muted">
            <i class="fas fa-info-circle me-2"></i>
            <span data-i18n="nomuscledata">No muscle group data available</span>
        </div>
    `);
}

    // Load cardio breakdown
    loadCardioBreakdown(period, dateFilter, weekStart, monthStart);
}

        // New function to load exercise details for a muscle group
function loadMuscleExerciseDetails(muscle, period, date, weekStart, monthStart, muscleId) {
    const detailSection = $(`#${muscleId}-details`);
    
    // Show loading
    detailSection.html('<div class="muscle-loading"><i class="fas fa-spinner fa-spin"></i> Loading exercises...</div>');
    
    // Format dates properly before sending to API
    const formattedDate = date ? formatDateForAPI(date) : null;
    const formattedWeekStart = weekStart ? formatDateForAPI(weekStart) : null;
    const formattedMonthStart = monthStart ? formatDateForAPI(monthStart) : null;
    
    // Build query parameters
    let url = `/workout/history/muscle/${encodeURIComponent(muscle)}?period=${period}`;
    if (formattedDate) {
        url += `&date=${formattedDate}`;
    }
    if (formattedWeekStart) {
        url += `&week_start=${formattedWeekStart}`;
    }
    if (formattedMonthStart) {
        url += `&month_start=${formattedMonthStart}`;
    }
    
    $.get(url, function(data) {
        if (!data.exercises || data.exercises.length === 0) {
            detailSection.html('<div class="text-center text-muted">No exercise data found</div>');
            return;
        }
        
        let html = '';
        data.exercises.forEach((exercise, index) => {
            const exerciseDetailId = `exercise-detail-${muscleId}-${index}`;
            
            // Calculate totals for the exercise
            const totalSets = exercise.sets.length;
            const totalReps = exercise.sets.reduce((sum, set) => sum + (set.reps || 0), 0);
            const totalVolume = exercise.sets.reduce((sum, set) => sum + (set.volume || 0), 0);
            const hasPR = exercise.sets.some(set => set.has_pr);
            
            // ✅ FIXED: Collapsible exercise header with toggle on RIGHT side
            html += `
                <div class="exercise-detail-container">
                    <div class="exercise-detail-header clickable-exercise-header" data-target="${exerciseDetailId}">
                        <div class="exercise-detail-title-row">
                            <div class="exercise-detail-title">
                                <span>${translateExerciseName(exercise.exercise_name)}</span>
                                ${hasPR ? '<i class="fas fa-trophy text-warning" style="font-size: 12px;" title="Sisältää PR"></i>' : ''}
                                <i class="fas fa-external-link-alt go-to-exercise" 
                                   data-exercise-id="${exercise.exercise_id}" 
                                   data-exercise-name="${exercise.exercise_name}"
                                   title="Go to exercise details"></i>
                            </div>
                            <div class="exercise-summary-stats">
                                <span class="exercise-summary-stat">${totalSets} sarjaa</span>
                                <span class="exercise-summary-stat">${totalReps} toistoa</span>
                                <span class="exercise-summary-stat">${totalVolume.toFixed(0)} kg</span>
                            </div>
                        </div>
                        
                    </div>
                    
                    <div id="${exerciseDetailId}" class="exercise-sets-container" style="display: none;">
                        <table class="exercise-sets-table">
                            <thead>
                                <tr>
                                    <th>Sarjat</th>
                                    <th>Toistot</th>
                                    <th>Paino</th>
                                    <th>Volyymi</th>
                                    ${period !== 'daily' ? '<th>Päivä</th>' : ''}
                                    <th>PR</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
exercise.sets.forEach(set => {
    const prBadges = [];
    
    // ✅ FIX: Use custom tooltip structure instead of title attribute
    if (set.is_heaviest_weight) {
        prBadges.push(`
            <span class="pr-tooltip">
                <i class="fa-solid fa-trophy text-warning pr-badge pr-heaviest"></i>
                <span class="tooltip-text">Raskain Paino PR</span>
            </span>
        `);
    }
    if (set.is_best_set) {
        prBadges.push(`
            <span class="pr-tooltip">
                <i class="fa-solid fa-fire text-danger pr-badge pr-best-set"></i>
                <span class="tooltip-text">Paras Sarja PR</span>
            </span>
        `);
    }
    
    const rowClass = set.has_pr ? 'pr-row' : '';
    
    html += `
        <tr class="${rowClass}">
            <td>${set.set_number}</td>
            <td>${set.reps}</td>
            <td>${set.weight}</td>
            <td>${set.volume.toFixed(1)}</td>
            ${period !== 'daily' ? `<td>${formatDate(set.date)}</td>` : ''}
            <td>${prBadges.join(' ') || '-'}</td>
        </tr>
    `;
});

// After rendering all HTML, add mobile touch handlers
detailSection.html(html);

// ✅ NEW: Add mobile touch handlers for tooltips
detailSection.find('.pr-tooltip').on('touchstart click', function(e) {
    e.stopPropagation();
    
    // Close other tooltips
    $('.pr-tooltip.active').not(this).removeClass('active');
    
    // Toggle this tooltip
    $(this).toggleClass('active');
});

// Close tooltips when clicking outside
$(document).on('touchstart click', function(e) {
    if (!$(e.target).closest('.pr-tooltip').length) {
        $('.pr-tooltip.active').removeClass('active');
    }
});
            
            html += `
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        });
        
        detailSection.html(html);
        
        // ✅ FIXED: Add click handlers for collapsible exercise headers
        detailSection.find('.clickable-exercise-header').off('click').on('click', function(e) {
            // Don't trigger if clicking the "go to exercise" icon
            if ($(e.target).hasClass('go-to-exercise')) {
                return;
            }
            
            e.preventDefault();
            e.stopPropagation();
            
            const targetId = $(this).data('target');
            const setsContainer = $(`#${targetId}`);
            const chevron = $(this).find('.exercise-chevron');
            
            if (setsContainer.is(':visible')) {
                // Collapse
                setsContainer.slideUp(200);
                chevron.removeClass('fa-chevron-down').addClass('fa-chevron-right');
            } else {
                // Expand
                setsContainer.slideDown(200);
                chevron.removeClass('fa-chevron-right').addClass('fa-chevron-down');
            }
        });
        
        // ✅ FIXED: Add click handlers for "go to exercise" icon with proper DOM element access
        detailSection.find('.go-to-exercise').off('click').on('click', function(e) {
    e.preventDefault();
    e.stopPropagation();
    
    const exerciseId = $(this).data('exercise-id');
    const exerciseName = $(this).data('exercise-name');
    
    console.log('Navigating to exercise:', exerciseId, exerciseName);
    
    // ✅ NEW: Store the exercise ID in session storage for persistence
    sessionStorage.setItem('selectedExerciseId', exerciseId);
    
    // Switch to exercises tab
    $('#exercises-tab').tab('show');
    
    // Wait for tab to be fully shown
    $('#exercises-tab').one('shown.bs.tab', function() {
        console.log('Exercises tab shown');
        
        // ✅ NEW: Check if exercises are already loaded
        const exercisesLoaded = $('#exercises-list tr.exercise-row').length > 0;
        
        if (!exercisesLoaded) {
            console.log('Loading exercises...');
            
            // ✅ NEW: Load exercises and then select the target exercise
            if (typeof loadExercises === 'function') {
                loadExercises(function() {
                    // Callback after exercises load
                    setTimeout(function() {
                        scrollToAndHighlightExercise(exerciseId);
                    }, 300);
                });
            } else {
                // Fallback if loadExercises doesn't support callback
                setTimeout(function() {
                    scrollToAndHighlightExercise(exerciseId);
                }, 500);
            }
        } else {
            // Exercises already loaded, just scroll and select
            console.log('Exercises already loaded, selecting...');
            scrollToAndHighlightExercise(exerciseId);
        }
    });
});
        
    }).fail(function(xhr) {
        console.error('Failed to load muscle details:', xhr);
        detailSection.html('<div class="text-center text-danger py-3">Failed to load exercise details</div>');
    });
}
function navigateToExerciseDetail(exerciseId, exerciseName) {
    // Switch to exercises tab
    $('#exercises-tab').tab('show');
    
    // Wait for tab to be fully shown
    $('#exercises-tab').one('shown.bs.tab', function() {
        // Load exercises if not already loaded
        if ($('#exercises-list tr').length === 0) {
            loadExercises();
        }
        
        // Wait a moment for exercises to load, then trigger the click
        setTimeout(function() {
            // Find and trigger click on the exercise row
            const $exerciseRow = $(`.exercise-row[data-id="${exerciseId}"]`);
            
            if ($exerciseRow.length > 0) {
                // Scroll to the exercise
                $exerciseRow[0].scrollIntoView({ behavior: 'smooth', block: 'center' });
                
                // Highlight the exercise briefly
                $exerciseRow.css('background-color', 'rgba(255, 209, 102, 0.3)');
                setTimeout(function() {
                    $exerciseRow.css('background-color', '');
                }, 1000);
                
                // Click the exercise to show details
                setTimeout(function() {
                    $exerciseRow.trigger('click');
                }, 500);
            } else {
                console.log('Exercise not found in list:', exerciseId, exerciseName);
            }
        }, 300);
    });
}
// New function to load cardio breakdown
function loadCardioBreakdown(period, date, weekStart, monthStart) {
    // Check if cardio breakdown container exists, if not create it
    let cardioSection = $(`#${period}-detail-cardio-breakdown`);
    if (cardioSection.length === 0) {
        $(`#${period}-detail-muscle-breakdown`).parent().after(`
            <div class="cardio-breakdown-section">
                <h5><i class="fas fa-running me-2"></i>Cardio Breakdown</h5>
                <div id="${period}-detail-cardio-breakdown">
                    <!-- Cardio sessions will be loaded here -->
                </div>
            </div>
        `);
        cardioSection = $(`#${period}-detail-cardio-breakdown`);
    }
    
    cardioSection.html('<div class="muscle-loading"><i class="fas fa-spinner fa-spin"></i> Loading cardio sessions...</div>');
    
    // ✅ FIX: Format dates properly before sending to API
    const formattedDate = date ? formatDateForAPI(date) : null;
    const formattedWeekStart = weekStart ? formatDateForAPI(weekStart) : null;
    const formattedMonthStart = monthStart ? formatDateForAPI(monthStart) : null;
    
    // Build query parameters
    let url = `/workout/history/cardio?period=${period}`;
    if (formattedDate) {
        url += `&date=${formattedDate}`;
    }
    if (formattedWeekStart) {
        url += `&week_start=${formattedWeekStart}`;
    }
    if (formattedMonthStart) {
        url += `&month_start=${formattedMonthStart}`;
    }
    
    $.get(url, function(data) {
        if (!data.cardio_sessions || data.cardio_sessions.length === 0) {
            cardioSection.html(`
                <div class="text-center text-muted py-3">
                    <i class="fas fa-info-circle me-2"></i>
                    <span>No cardio sessions recorded</span>
                </div>
            `);
            return;
        }
        
        let html = '';
        data.cardio_sessions.forEach(session => {
            html += `
                <div class="cardio-session-card">
                    <div class="cardio-session-header">
                        <div class="cardio-type">
                            ${getCardioIcon(session.exercise_type)} ${session.cardio_type} - Cardio
                        </div>
                        ${period !== 'daily' && session.date ? `<div class="text-muted" style="font-size: 11px;">${formatDate(session.date)}</div>` : ''}
                    </div>
                    <div class="cardio-stats">
                        <div class="cardio-stat-item">
                            <div class="cardio-stat-label">Aika</div>
                            <div class="cardio-stat-value">${session.duration_minutes} min</div>
                        </div>
                        ${session.distance_km > 0 ? `
                        <div class="cardio-stat-item">
                            <div class="cardio-stat-label">Pituus (KM)</div>
                            <div class="cardio-stat-value">${session.distance_km.toFixed(2)} km</div>
                        </div>
                        ` : ''}
                        ${session.avg_pace_min_per_km ? `
                        <div class="cardio-stat-item">
                            <div class="cardio-stat-label">Keskim. Tahti </div>
                            <div class="cardio-stat-value">${formatPace(session.avg_pace_min_per_km)}/km</div>
                        </div>
                        ` : ''}
                        ${session.avg_heart_rate ? `
                        <div class="cardio-stat-item">
                            <div class="cardio-stat-label">Keskisyke</div>
                            <div class="cardio-stat-value">${session.avg_heart_rate} bpm</div>
                        </div>
                        ` : ''}
                        ${session.calories_burned > 0 ? `
                        <div class="cardio-stat-item">
                            <div class="cardio-stat-label">Kalorit</div>
                            <div class="cardio-stat-value">${Math.round(session.calories_burned)}</div>
                        </div>
                        ` : ''}
                    </div>
                    ${session.notes ? `<div class="text-muted" style="font-size: 11px; margin-top: 8px;">${session.notes}</div>` : ''}
                </div>
            `;
        });
        
        cardioSection.html(html);
    }).fail(function(xhr) {
        console.error('Failed to load cardio sessions:', xhr);
        cardioSection.html('<div class="text-center text-danger py-3">Failed to load cardio data</div>');
    });
}


function getCardioIcon(exerciseType) {
    const icons = {
        'running': '<i class="fas fa-running"></i>',
        'cycling': '<i class="fas fa-biking"></i>',
        'swimming': '<i class="fas fa-person-swimming"></i>',
        'walking': '<i class="fas fa-walking"></i>',
        'rowing': '<i class="fas fa-water"></i>',
        'elliptical': '<i class="fas fa-dumbbell"></i>',
        'stairmaster': '<i class="fas fa-stairs"></i>',
        'hiking': '<i class="fas fa-mountain"></i>',
        'other': '<i class="fas fa-heart-pulse"></i>'
    };
    
    return icons[exerciseType] || icons['other'];
}

// Format pace from decimal minutes to min:sec format
function formatPace(paceMinutes) {
    if (!paceMinutes || paceMinutes <= 0) return '--:--';
    
    const minutes = Math.floor(paceMinutes);
    const seconds = Math.round((paceMinutes - minutes) * 60);
    
    return `${minutes}:${seconds.toString().padStart(2, '0')}`;
}
function loadExercises(callback) {
    $.get('/workout/exercises', function(data) {
        renderExercisesList(data.exercises);
        
        // ✅ NEW: Call callback if provided
        if (typeof callback === 'function') {
            callback();
        }
        
        // ✅ NEW: Check if there's a stored exercise ID to select
        const selectedExerciseId = sessionStorage.getItem('selectedExerciseId');
        if (selectedExerciseId) {
            sessionStorage.removeItem('selectedExerciseId');
            setTimeout(function() {
                scrollToAndHighlightExercise(parseInt(selectedExerciseId));
            }, 300);
        }
    }).fail(function() {
        alert('Failed to load exercises');
        if (typeof callback === 'function') {
            callback();
        }
    });
}
// Helper function to format date (keep this one too)
function formatDate(dateStr) {
    if (!dateStr) return '';
    const date = new Date(dateStr);
    return `${date.getDate()}/${date.getMonth() + 1}`;
}

function scrollToAndHighlightExercise(exerciseId) {
    console.log('Looking for exercise:', exerciseId);
    
    // Find the exercise row
    const exerciseRow = $(`.exercise-row[data-id="${exerciseId}"]`);
    
    if (exerciseRow.length > 0) {
        console.log('Found exercise row:', exerciseId);
        
        // ✅ FIX: Get DOM element from jQuery object properly
        const domElement = exerciseRow.get(0);
        
        if (domElement && typeof domElement.scrollIntoView === 'function') {
            domElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
        } else {
            // Fallback: use jQuery scrollTop
            const container = exerciseRow.closest('.table-responsive');
            if (container.length > 0) {
                container.animate({
                    scrollTop: exerciseRow.position().top + container.scrollTop() - container.height() / 2
                }, 500);
            }
        }
        
        // Highlight the exercise briefly
        exerciseRow.css('background-color', 'rgba(255, 209, 102, 0.3)');
        setTimeout(function() {
            exerciseRow.css('background-color', '');
        }, 1500);
        
        // ✅ NEW: Actually trigger the click to load exercise details
        setTimeout(function() {
            console.log('Clicking exercise row to load details');
            exerciseRow.trigger('click');
            
            // ✅ NEW: After clicking, also call loadExerciseDetail directly if it exists
            const exerciseName = exerciseRow.data('name');
            if (typeof loadExerciseDetail === 'function') {
                loadExerciseDetail(exerciseId);
            }
        }, 800);
    } else {
        console.log('Exercise not found in list:', exerciseId);
        
        // ✅ NEW: If exercise not found, try to load it directly
        if (typeof loadExerciseDetail === 'function') {
            console.log('Attempting to load exercise details directly');
            loadExerciseDetail(exerciseId);
        }
    }
}
// ---------- Render exercise chart ----------
function renderExerciseChart(history) {
    const ctx = document.getElementById('exercise-chart').getContext('2d');

    if (exerciseChart) exerciseChart.destroy();

    const sortedHistory = [...history].sort((a, b) => {
        const [dA, mA, yA] = a.date.split('.');
        const [dB, mB, yB] = b.date.split('.');
        return new Date(`${yA}-${mA}-${dA}`) - new Date(`${yB}-${mB}-${dB}`);
    });

    const dates = sortedHistory.map(h => h.date);
    const volumes = sortedHistory.map(h => h.volume || 0);
    const bestWeights = sortedHistory.map(h => h.best_weight || 0);
    const volumePointColors = sortedHistory.map(h => h.is_pr ? '#ffd166' : '#4cc9f0');
    const volumePointRadius = sortedHistory.map(h => h.is_pr ? 6 : 3);
    const weightPointColors = sortedHistory.map(h => h.is_pr ? '#ffd166' : '#f72585');
    const weightPointRadius = sortedHistory.map(h => h.is_pr ? 6 : 3);

    // Precompute trend percentages
    const trendValues = sortedHistory.map((h, i) => {
        if (i === 0) return null;
        const prevVolume = sortedHistory[i-1].volume || 0;
        return prevVolume ? ((h.volume - prevVolume) / prevVolume) * 100 : null;
    });

    exerciseChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: dates,
            datasets: [
                {
                    label: 'Volyymi (kg)',
                    data: volumes,
                    borderColor: '#4cc9f0',
                    backgroundColor: 'rgba(76,201,240,0.1)',
                    borderWidth: 2,
                    tension: 0.3,
                    yAxisID: 'y',
                    pointBackgroundColor: volumePointColors,
                    pointRadius: volumePointRadius,
                },
                {
                    label: 'Raskain Paino (kg)',
                    data: bestWeights,
                    borderColor: '#f72585',
                    backgroundColor: 'rgba(247,37,133,0.1)',
                    borderWidth: 2,
                    tension: 0.3,
                    yAxisID: 'y1',
                    pointBackgroundColor: weightPointColors,
                    pointRadius: weightPointRadius,
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: { grid: { color: 'rgba(255,255,255,0.1)' }, ticks: { color: '#e0e0e0' } },
                y: { 
                    type: 'linear', 
                    display: true, 
                    position: 'left', 
                    title: { display: true, text: 'Volyymi (kg)', color: '#e0e0e0' },
                    grid: { color: 'rgba(255,255,255,0.1)' }, 
                    ticks: { color: '#e0e0e0' } 
                },
                y1: { 
                    type: 'linear', 
                    display: true, 
                    position: 'right', 
                    title: { display: true, text: 'Paino (kg)', color: '#e0e0e0' },
                    grid: { drawOnChartArea: false, color: 'rgba(255,255,255,0.1)' }, 
                    ticks: { color: '#e0e0e0' } 
                }
            },
            plugins: {
                legend: { labels: { color: '#e0e0e0' } },
                tooltip: {
                    callbacks: {
                        afterLabel: function(context) {
                            const index = context.dataIndex;
                            if (trendValues[index] !== null) {
                                const trend = trendValues[index];
                                return `Trend: ${trend >= 0 ? '+' : ''}${smartPercent(trend)} from previous`;
                            }
                            return null;
                        }
                    }
                }
            }
        }
    });
}
        
        // Render sessions table
        function renderSessionsTable(history) {
            const container = $("#exercise-sessions");
            container.empty();

            // Sort ascending by date (oldest first)
            const ascendingHistory = [...history].sort((a, b) => {
                const [dA, mA, yA] = a.date.split('-');
                const [dB, mB, yB] = b.date.split('-');
                return new Date(`${yA}-${mA}-${dA}`) - new Date(`${yB}-${mB}-${dB}`);
            });

            let runningBest = 0;
            ascendingHistory.forEach(session => {
                if (session.best_weight > runningBest) {
                    session.is_pr = true;
                    runningBest = session.best_weight;
                } else {
                    session.is_pr = false;
                }
            });

            // Now display in descending order
            const sortedHistory = [...ascendingHistory]

            if (sortedHistory.length === 0) {
                container.append(`<tr><td colspan="4" class="text-center py-4">${t("no_session_history")}</td></tr>`);
                return;
            }

            sortedHistory.forEach(session => {
                let prIndicator = '';
                if (session.is_pr) {
                    prIndicator = ` <i class="fa-solid fa-trophy text-warning" title="Oma Ennätys: ${session.best_weight} kg"></i>`;
                }

                const row = `
                    <tr>
                        <td>${session.date}${prIndicator}</td>
                        <td class="text-end">${session.sets || 0}</td>
                        <td class="text-end">${session.best_set || '-'}</td>
                        <td class="text-end">${(session.volume || 0).toFixed(1)} kg</td>
                    </tr>`;
                container.append(row);
            });
        
container.find('.pr-tooltip').on('touchstart click', function(e) {
    e.stopPropagation();
    
    // Close other tooltips
    $('.pr-tooltip.active').not(this).removeClass('active');
    
    // Toggle this tooltip
    $(this).toggleClass('active');
});
}
        // Workout history tab functionality
        $('#workoutHistoryTabs button').click(function() {
            const period = $(this).attr('id').split('-')[0];
            loadWorkoutHistory(period);
        });

        // Initialize workout history if needed
        if (window.location.hash === '#workouts') loadWorkoutHistory('daily');

        // Workout history functions
        function loadWorkoutHistory(period) {
            $.get("/workout/history?period=" + period, function(data) {
                renderWorkoutHistoryCards(data.history, period);
            }).fail(function() {
                const containerId = period + "-workout-list";
                $("#" + containerId).html(`
                    <div class="empty-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h4>Failed to load workout data</h4>
                        <p>Please try again later.</p>
                    </div>`);
            });
        }
                    
                    // NEW: Render workout history as cards
            function renderWorkoutHistoryCards(history, period) {
                const container = $("#" + period + "-workout-list");
                container.empty();

                if (!history || history.length === 0) {
                    container.html(`
                        <div class="empty-state">
                            <i class="fas fa-dumbbell"></i>
                            <h4>No workout data available</h4>
                            <p>Start tracking your workouts to see ${period} history</p>
                        </div>`);
                    return;
                }

                history.forEach(item => {
                    let periodLabel = '';
                    let muscleGroupCount = Object.keys(item.muscles || {}).length;

                    if (period === 'daily') {
                        const date = new Date(item.date);
                        const weekday = date.toLocaleDateString('en-US', { weekday: 'short' }).toLowerCase();
                        const translatedWeekday = translateWeekday(weekday);
                        periodLabel = `${translatedWeekday}, ${date.getDate()}/${date.getMonth() + 1}`;
                        
                        // For daily view, show individual workout name
                        workoutName = item.workout_name || 'Unnamed Workout';
                    } else if (period === 'weekly') {
                        const startDate = new Date(item.week_start);
                        const weekEnd = new Date(startDate); 
                        weekEnd.setDate(weekEnd.getDate() + 6);
                        const startMonth = translateMonth(startDate.toLocaleDateString('en-US', {month:'long'}).toLowerCase());
                        const endMonth = translateMonth(weekEnd.toLocaleDateString('en-US', {month:'long'}).toLowerCase());
                        periodLabel = `${startDate.getDate()} ${startMonth} - ${weekEnd.getDate()} ${endMonth}`;
                        
                        // For weekly/monthly view, show workout names summary
                        workoutName = item.workout_names_display || 'Various Workouts';
                    } else {
                        const startDate = new Date(item.month_start);
                        const monthName = translateMonth(startDate.toLocaleDateString('en-US', {month:'long'}).toLowerCase());
                        periodLabel = `${monthName} ${startDate.getFullYear()}`;
                        
                        workoutName = item.workout_names_display || 'Various Workouts';
                    }

                    const cardHtml = `
                        <div class="workout-period-card" data-period="${period}" data-item='${JSON.stringify(item)}'>
                            <div class="period-title">${periodLabel}</div>
                            <div class="workout-name" style="font-size: 12px; color: #888; margin-bottom: 8px;">${workoutName}</div>
                            <div class="period-stats">
                                <div class="stat-item">
                                    <div class="stat-value">${item.sessions_count || 0}</div>
                                    <div class="stat-label">Harjoitukset</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">${item.duration_formatted || '0m'}</div>
                                    <div class="stat-label">Aika</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">${Math.round(item.calories_burned || 0)}</div>
                                    <div class="stat-label">Kalorit</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">${muscleGroupCount}</div>
                                    <div class="stat-label" data-i18n="muscles">Lihasryhmät</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">${item.total_sets || 0}</div>
                                    <div class="stat-label" data-i18n="sets">Sarjat</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">${parseFloat(item.total_volume || 0).toFixed(0)}</div>
                                    <div class="stat-label">Volyymi (kg)</div>
                                </div>
                            </div>
                        </div>`;
                    
                    container.append(cardHtml);
                });

                // Add click handlers for cards
                $('.workout-period-card').click(function() {
                    const period = $(this).data('period');
                    const item = $(this).data('item');
                    showWorkoutDetail(period, item);
                });
            }

        // Show workout detail view

        
        // Function to update progress bars with targets from server
        function updateProgressBarsWithTargets() {
            $.get('/get_nutrition_targets', function(targets) {
                // Update protein progress bars
                $('.progress-bar-protein').each(function() {
                    const value = $(this).data('value');
                    const percentage = Math.min(100, (value / targets.proteins) * 100);
                    $(this).css('width', percentage + '%');
                });
                
                // Update fats progress bars
                $('.progress-bar-fats').each(function() {
                    const value = $(this).data('value');
                    const percentage = Math.min(100, (value / targets.fats) * 100);
                    $(this).css('width', percentage + '%');
                });
                
                // Update salt progress bars
                $('.progress-bar-salt').each(function() {
                    const value = $(this).data('value');
                    const percentage = Math.min(100, (value / targets.salt) * 100);
                    $(this).css('width', percentage + '%');
                });
                // Update saturated progress bars
                $('.progress-bar-saturated').each(function() {
                    const value = $(this).data('value');
                    const percentage = Math.min(100, (value / targets.saturated) * 100);
                    $(this).css('width', percentage + '%');
                });
                 // Update fiber progress bars
                $('.progress-bar-fiber').each(function() {
                    const value = $(this).data('value');
                    const percentage = Math.min(100, (value / targets.fiber) * 100);
                    $(this).css('width', percentage + '%');
                });
                 // Update sugars progress bars
                $('.progress-bar-sugars').each(function() {
                    const value = $(this).data('value');
                    const percentage = Math.min(100, (value / targets.sugars) * 100);
                    $(this).css('width', percentage + '%');
                });
                
                // Carbs target is not in the API response, keeping the original logic
                $('.progress-bar-carbs').each(function() {
                    const value = $(this).data('value');
                    const percentage = Math.min(100, (value / 250) * 100);
                    $(this).css('width', percentage + '%');
                });
            }).fail(function() {
                console.error('Failed to fetch nutrition targets');
                // Fallback to original values if API fails
                $('.progress-bar-protein').each(function() {
                    const value = $(this).data('value');
                    const percentage = Math.min(100, (value / 150) * 100);
                    $(this).css('width', percentage + '%');
                });
                $('.progress-bar-fats').each(function() {
                    const value = $(this).data('value');
                    const percentage = Math.min(100, (value / 70) * 100);
                    $(this).css('width', percentage + '%');
                });
                $('.progress-bar-salt').each(function() {
                    const value = $(this).data('value');
                    const percentage = Math.min(100, (value / 5) * 100);
                    $(this).css('width', percentage + '%');
                });
                $('.progress-bar-carbs').each(function() {
                    const value = $(this).data('value');
                    const percentage = Math.min(100, (value / 250) * 100);
                    $(this).css('width', percentage + '%');
                });
                 $('.progress-bar-fiber').each(function() {
                    const value = $(this).data('value');
                    const percentage = Math.min(100, (value / 30) * 100);
                    $(this).css('width', percentage + '%');
                });
                $('.progress-bar-sugars').each(function() {
                    const value = $(this).data('value');
                    const percentage = Math.min(100, (value / 60) * 100);
                    $(this).css('width', percentage + '%');
                });
                $('.progress-bar-saturated').each(function() {
                    const value = $(this).data('value');
                    const percentage = Math.min(100, (value / 20) * 100);
                    $(this).css('width', percentage + '%');
                });
            });
        }
        
   
    </script>
    
    <script>
        // Initialize tooltips globally
        document.addEventListener("DOMContentLoaded", function () {
            const tooltipTriggerList = [].slice.call(
                document.querySelectorAll('[data-bs-toggle="tooltip"]')
            )
            tooltipTriggerList.map(el => new bootstrap.Tooltip(el))
        })
    </script>
</body>
</html>
